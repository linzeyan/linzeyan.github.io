<!doctype html><html lang=zh-tw><head><title>Server-Configs Notes</title><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=X-UA-Compatible content="ie=edge"><link rel=stylesheet href=/application.780dc7a6fc8e42bf9fef490724bc6cbc57e759a0db2df60fcd517f9f667085ed.css integrity="sha256-eA3HpvyOQr+f70kHJLxsvFfnWaDbLfYPzVF/n2Zwhe0="><link rel=icon type=image/png href=/images/site/highlight.svg><meta property="og:title" content="Ricky"><meta property="og:type" content="website"><meta property="og:description" content="Ricky 的網頁"><meta property="og:image" content="/images/author/ava.jpg"><meta property="og:url" content="https://linzeyan.github.io/"><script defer src=https://static.cloudflareinsights.com/beacon.min.js data-cf-beacon='{"token": "27a0cd9f0e3b46909879cf99f7cc6878"}'></script><script integrity="sha256-DO4ugzEwhTW1Id1UIWn0gUJWaebCYOypeTit6LW4QB4=">let theme=localStorage.getItem("theme-scheme")||localStorage.getItem("darkmode:color-scheme")||"light";theme==="system"&&(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?theme="dark":theme="light"),document.documentElement.setAttribute("data-theme",theme)</script></head><body class="type-notes kind-page" data-bs-spy=scroll data-bs-target=#TableOfContents data-bs-offset=80><div class="container-fluid bg-secondary wrapper"><nav class="navbar navbar-expand-xl top-navbar shadow" id=top-navbar><div class=container><button class="navbar-toggler navbar-light" id=sidebar-toggler type=button>
<i data-feather=sidebar></i>
</button>
<a class=navbar-brand href=/zh-tw><img src=/images/site/highlight.svg id=logo alt=Logo>
Ricky</a>
<button class="navbar-toggler navbar-light" id=navbar-toggler type=button data-bs-toggle=collapse data-bs-target=#top-nav-items aria-label=menu>
<i data-feather=menu></i></button><div class="collapse navbar-collapse dynamic-navbar" id=top-nav-items><ul class="nav navbar-nav ms-auto"><li class=nav-item><a class=nav-link href=/zh-tw#home>首頁</a></li><li class=nav-item><a class=nav-link href=/zh-tw#about>關於</a></li><li class="nav-item dropdown"><a class="nav-link dropdown-toggle" href=# id=navbarDropdown role=button data-bs-toggle=dropdown aria-haspopup=true aria-expanded=false>更多的</a><div class=dropdown-menu aria-labelledby=navbarDropdown><a class=dropdown-item href=/zh-tw#skills>技能</a>
<a class=dropdown-item href=/zh-tw#experiences>經歷</a>
<a class=dropdown-item href=/zh-tw#education>學歷</a>
<a class=dropdown-item href=/zh-tw#projects>專案</a></div></li><div id=top-navbar-divider></div><li class=nav-item><a class=nav-link id=blog-link href=/zh-tw/posts>文章</a></li><li class=nav-item><a class=nav-link id=note-link href=/zh-tw/notes>筆記</a></li><li class=nav-item><a class=nav-link href=https://linzeyan.github.io/activities>活動</a></li><li class=nav-item><a class=nav-link href=https://linzeyan.github.io/running>跑步</a></li><li class="nav-item dropdown"><a class="nav-link dropdown-toggle" href=# id=languageSelector role=button data-bs-toggle=dropdown aria-haspopup=true aria-expanded=false><span class="fi fi-tw"></span>
Chinese</a><div class=dropdown-menu aria-labelledby=languageSelector><a class="dropdown-item nav-link languages-item" href=/notes/server><span class="fi fi-us"></span>
English
</a><a class="dropdown-item nav-link languages-item" href=/zh-tw/notes/server><span class="fi fi-tw"></span>
Chinese</a></div></li><li class="nav-item dropdown"><a class="nav-link dropdown-toggle" href=# id=themeSelector role=button data-bs-toggle=dropdown aria-haspopup=true aria-expanded=false><img id=navbar-theme-icon-svg class=theme-icon src=/icons/moon-svgrepo-com.svg width=20 alt="Dark Theme"></a><div id=themeMenu class="dropdown-menu dropdown-menu-icons-only" aria-labelledby=themeSelector><a class="dropdown-item nav-link" href=# data-scheme=light><img class=theme-icon src=/icons/sun-svgrepo-com.svg width=20 alt="Light Theme">
</a><a class="dropdown-item nav-link" href=# data-scheme=dark><img class=theme-icon src=/icons/moon-svgrepo-com.svg width=20 alt="Dark Theme">
</a><a class="dropdown-item nav-link" href=# data-scheme=system><img class=theme-icon src=/icons/computer-svgrepo-com.svg width=20 alt="System Theme"></a></div></li></ul></div></div><img src=/images/site/highlight.svg class=d-none id=main-logo alt=Logo>
<img src=/images/site/highlight.svg class=d-none id=inverted-logo alt="Inverted Logo"></nav><section class=sidebar-section id=sidebar-section><div class=sidebar-holder><div class=sidebar id=sidebar><form class=mx-auto method=get action=/zh-tw/search><input type=text name=keyword placeholder=搜尋 data-search id=search-box></form><div class=sidebar-tree><ul class=tree id=tree><li id=list-heading><a href=/zh-tw/notes data-filter=all>筆記</a></li><div class=subtree><li><i data-feather=plus-circle></i><a class=list-link href=/zh-tw/notes/aws/> AWS</a><ul><li><a class=list-link href=/zh-tw/notes/aws/command/ title=command>command</a></li><li><a class=list-link href=/zh-tw/notes/aws/configure/ title=configure>configure</a></li><li><a class=list-link href=/zh-tw/notes/aws/terraform/ title=terraform>terraform</a></li></ul></li><li><i data-feather=plus-circle></i><a class=list-link href=/zh-tw/notes/bash/> Bash</a><ul><li><a class=list-link href=/zh-tw/notes/bash/ansible/ title=ansible>ansible</a></li><li><a class=list-link href=/zh-tw/notes/bash/common/ title=common>common</a></li><li><a class=list-link href=/zh-tw/notes/bash/docker/ title=docker>docker</a></li><li><a class=list-link href=/zh-tw/notes/bash/file/ title=file>file</a></li><li><a class=list-link href=/zh-tw/notes/bash/git/ title=git>git</a></li><li><a class=list-link href=/zh-tw/notes/bash/gitlab/ title=gitlab>gitlab</a></li><li><a class=list-link href=/zh-tw/notes/bash/gpg/ title=gpg>gpg</a></li><li><a class=list-link href=/zh-tw/notes/bash/k8s/ title=k8s>k8s</a></li><li><a class=list-link href=/zh-tw/notes/bash/network/ title=network>network</a></li><li><a class=list-link href=/zh-tw/notes/bash/pandoc/ title=pandoc>pandoc</a></li><li><a class=list-link href=/zh-tw/notes/bash/redis/ title=redis>redis</a></li><li><a class=list-link href=/zh-tw/notes/bash/ssh/ title=ssh>ssh</a></li><li><a class=list-link href=/zh-tw/notes/bash/telegram/ title=telegram>telegram</a></li></ul></li><li><i data-feather=plus-circle></i><a class=list-link href=/zh-tw/notes/docs/> Docs</a><ul><li><a class=list-link href=/zh-tw/notes/docs/cloudflare/ title=cloudflare>cloudflare</a></li><li><a class=list-link href=/zh-tw/notes/docs/diagrams/ title=diagrams>diagrams</a></li><li><a class=list-link href=/zh-tw/notes/docs/docker/ title=docker>docker</a></li><li><a class=list-link href=/zh-tw/notes/docs/gitlab/ title=gitlab>gitlab</a></li><li><a class=list-link href=/zh-tw/notes/docs/linux/ title=linux>linux</a></li><li><a class=list-link href=/zh-tw/notes/docs/mermaid/ title=mermaid>mermaid</a></li><li><a class=list-link href=/zh-tw/notes/docs/network/ title=network>network</a></li><li><a class=list-link href=/zh-tw/notes/docs/nginx/ title=nginx>nginx</a></li><li><a class=list-link href=/zh-tw/notes/docs/vagrant/ title=vagrant>vagrant</a></li><li><a class=list-link href=/zh-tw/notes/docs/zabbix/ title=zabbix>zabbix</a></li></ul></li><li><a class=list-link href=/zh-tw/notes/elasticsearch/ title=Elasticsearch>Elasticsearch</a></li><li><i data-feather=plus-circle></i><a class=list-link href=/zh-tw/notes/gcp/> GCP</a><ul><li><a class=list-link href=/zh-tw/notes/gcp/command/ title=command>command</a></li></ul></li><li><i data-feather=plus-circle></i><a class=list-link href=/zh-tw/notes/go/> Go</a><ul><li><a class=list-link href=/zh-tw/notes/go/libraries/ title=Libraries>Libraries</a></li><li><i data-feather=plus-circle></i><a class=list-link href=/zh-tw/notes/go/questions/> Questions</a><ul><li><a class=list-link href=/zh-tw/notes/go/questions/array/ title=Array>Array</a></li><li><a class=list-link href=/zh-tw/notes/go/questions/channel/ title=Channel>Channel</a></li><li><a class=list-link href=/zh-tw/notes/go/questions/context/ title=Context>Context</a></li><li><a class=list-link href=/zh-tw/notes/go/questions/defer/ title=Defer>Defer</a></li><li><a class=list-link href=/zh-tw/notes/go/questions/goroutine/ title=Goroutine>Goroutine</a></li><li><a class=list-link href=/zh-tw/notes/go/questions/interface/ title=Interface>Interface</a></li><li><a class=list-link href=/zh-tw/notes/go/questions/iota/ title=Iota>Iota</a></li><li><a class=list-link href=/zh-tw/notes/go/questions/json/ title=JSON>JSON</a></li><li><a class=list-link href=/zh-tw/notes/go/questions/len/ title=Len>Len</a></li><li><a class=list-link href=/zh-tw/notes/go/questions/map/ title=Map>Map</a></li><li><a class=list-link href=/zh-tw/notes/go/questions/print/ title=Print>Print</a></li><li><a class=list-link href=/zh-tw/notes/go/questions/race/ title=Race>Race</a></li><li><a class=list-link href=/zh-tw/notes/go/questions/select/ title=Select>Select</a></li><li><a class=list-link href=/zh-tw/notes/go/questions/slice/ title=Slice>Slice</a></li><li><a class=list-link href=/zh-tw/notes/go/questions/variable/ title=Variable>Variable</a></li></ul></li><li><a class=list-link href=/zh-tw/notes/go/snippet/ title=Snippet>Snippet</a></li><li><a class=list-link href=/zh-tw/notes/go/tools/ title=Tools>Tools</a></li></ul></li><li><a class=list-link href=/zh-tw/notes/input-method/ title=Input-Method>Input-Method</a></li><li><a class="active list-link" href=/zh-tw/notes/server/ title=Server-Configs>Server-Configs</a></li></div></ul></div></div></div></section><section class=content-section id=content-section><div class="content container-fluid" id=content><div class="container-fluid note-card-holder" id=note-card-holder><div class=note-card><div class=item><h5 class=note-title><span>Kafka</span></h5><div class=card><div class=card-body><h6 id=consumerproperties>consumer.properties</h6><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ini data-lang=ini><span style=display:flex><span><span style=color:#a6e22e>max.partition.fetch.bytes</span><span style=color:#f92672>=</span><span style=color:#e6db74>104857600</span>
</span></span></code></pre></div><h6 id=serverproperties>server.properties</h6><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ini data-lang=ini><span style=display:flex><span><span style=color:#a6e22e>socket.send.buffer.bytes</span><span style=color:#f92672>=</span><span style=color:#e6db74>1048576000</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>socket.receive.buffer.bytes</span><span style=color:#f92672>=</span><span style=color:#e6db74>1048576000</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>log.retention.bytes</span><span style=color:#f92672>=</span><span style=color:#e6db74>-1</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>group.initial.rebalance.delay.ms</span><span style=color:#f92672>=</span><span style=color:#e6db74>0</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>max.message.bytes</span><span style=color:#f92672>=</span><span style=color:#e6db74>1048576000</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>fetch.message.max.bytes</span><span style=color:#f92672>=</span><span style=color:#e6db74>1048576000</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>replica.fetch.max.bytes</span><span style=color:#f92672>=</span><span style=color:#e6db74>1048576000</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>socket.request.max.bytes</span><span style=color:#f92672>=</span><span style=color:#e6db74>1048576000</span>
</span></span><span style=display:flex><span><span style=color:#75715e># 单个索引文件最大 10 MB</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>log.index.size.max.bytes</span><span style=color:#f92672>=</span><span style=color:#e6db74>10485760</span>
</span></span><span style=display:flex><span><span style=color:#75715e># 日志段大小 512 MB（根据需要再调小）</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>log.segment.bytes</span><span style=color:#f92672>=</span><span style=color:#e6db74>536870912</span>
</span></span><span style=display:flex><span><span style=color:#75715e># 避免過多 client 連進來撐爆 broker</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>max.connections</span><span style=color:#f92672>=</span><span style=color:#e6db74>50000</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>max.connections.per.ip</span><span style=color:#f92672>=</span><span style=color:#e6db74>20000</span>
</span></span><span style=display:flex><span><span style=color:#75715e># 逾時</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>connections.max.idle.ms</span><span style=color:#f92672>=</span><span style=color:#e6db74>300000</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>request.timeout.ms</span><span style=color:#f92672>=</span><span style=color:#e6db74>60000</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># —— 高并发优化配置 ——</span>
</span></span><span style=display:flex><span><span style=color:#75715e># 若需要更高吞吐、能接受更高的调度开销</span>
</span></span><span style=display:flex><span><span style=color:#75715e># num.network.threads=2    # 网络线程数 → CPU 核心数</span>
</span></span><span style=display:flex><span><span style=color:#75715e># num.io.threads=4         # I/O 线程数 → 核心数×2</span>
</span></span><span style=display:flex><span><span style=color:#75715e># 一般num.network.threads主要处理网络io，读写缓冲区数据，基本没有io等待，配置线程数量为cpu核数加1</span>
</span></span><span style=display:flex><span><span style=color:#75715e># num.io.threads主要进行磁盘io操作，高峰期可能有些io等待，因此配置需要大些。配置线程数量为cpu核数2倍，最大不超过3倍.</span>
</span></span></code></pre></div></div></div></div></div><div class=note-card><div class=item><h5 class=note-title><span>Matomo</span></h5><div class=card><div class=card-body><h6 id=nginxconf>nginx.conf</h6><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nginx data-lang=nginx><span style=display:flex><span><span style=color:#66d9ef>user</span> <span style=color:#e6db74>www-data</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>worker_processes</span> <span style=color:#e6db74>auto</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>pid</span> <span style=color:#e6db74>/run/nginx.pid</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>include</span> /etc/nginx/modules-enabled/*.conf;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>events</span> {
</span></span><span style=display:flex><span>	<span style=color:#f92672>worker_connections</span> <span style=color:#ae81ff>768</span>;
</span></span><span style=display:flex><span>	<span style=color:#75715e># multi_accept on;
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>http</span> {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>##
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#75715e># Basic Settings
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#75715e>##
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>sendfile</span> <span style=color:#66d9ef>on</span>;
</span></span><span style=display:flex><span>	<span style=color:#f92672>tcp_nopush</span> <span style=color:#66d9ef>on</span>;
</span></span><span style=display:flex><span>	<span style=color:#f92672>types_hash_max_size</span> <span style=color:#ae81ff>2048</span>;
</span></span><span style=display:flex><span>	<span style=color:#f92672>server_tokens</span> <span style=color:#66d9ef>off</span>;
</span></span><span style=display:flex><span>	<span style=color:#75715e># 同時調高打開的檔案數
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#f92672>open_file_cache</span>   <span style=color:#e6db74>max=1000</span> <span style=color:#e6db74>inactive=20s</span>;
</span></span><span style=display:flex><span>        <span style=color:#f92672>open_file_cache_valid</span> <span style=color:#e6db74>30s</span>;
</span></span><span style=display:flex><span>        <span style=color:#f92672>open_file_cache_min_uses</span> <span style=color:#ae81ff>2</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e># server_names_hash_bucket_size 64;
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#75715e># server_name_in_redirect off;
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>include</span> <span style=color:#e6db74>/etc/nginx/mime.types</span>;
</span></span><span style=display:flex><span>	<span style=color:#f92672>default_type</span> <span style=color:#e6db74>application/octet-stream</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>##
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#75715e># SSL Settings
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#75715e>##
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>ssl_protocols</span> <span style=color:#e6db74>TLSv1</span> <span style=color:#e6db74>TLSv1.1</span> <span style=color:#e6db74>TLSv1.2</span> <span style=color:#e6db74>TLSv1.3</span>; <span style=color:#75715e># Dropping SSLv3, ref: POODLE
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#f92672>ssl_prefer_server_ciphers</span> <span style=color:#66d9ef>on</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>##
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#75715e># Logging Settings
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#75715e>##
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>access_log</span> <span style=color:#e6db74>/var/log/nginx/access.log</span>;
</span></span><span style=display:flex><span>	<span style=color:#f92672>error_log</span> <span style=color:#e6db74>/var/log/nginx/error.log</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>##
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#75715e># Gzip Settings
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#75715e>##
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>gzip</span> <span style=color:#66d9ef>on</span>;
</span></span><span style=display:flex><span>        <span style=color:#f92672>gzip_min_length</span>  <span style=color:#ae81ff>1024</span>;
</span></span><span style=display:flex><span>        <span style=color:#f92672>gzip_comp_level</span>  <span style=color:#ae81ff>5</span>;
</span></span><span style=display:flex><span>        <span style=color:#f92672>gzip_proxied</span>     <span style=color:#e6db74>any</span>;
</span></span><span style=display:flex><span>        <span style=color:#f92672>gzip_types</span>       <span style=color:#e6db74>text/plain</span> <span style=color:#e6db74>text/css</span> <span style=color:#e6db74>application/javascript</span> <span style=color:#e6db74>application/json</span> <span style=color:#e6db74>image/svg+xml</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># 全域 expires 規則
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#f92672>expires</span> <span style=color:#e6db74>1d</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>add_header</span> <span style=color:#e6db74>Cache-Control</span> <span style=color:#e6db74>&#34;public&#34;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e># gzip_vary on;
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#75715e># gzip_proxied any;
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#75715e># gzip_comp_level 6;
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#75715e># gzip_buffers 16 8k;
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#75715e># gzip_http_version 1.1;
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#75715e># gzip_types text/plain text/css application/json application/javascript text/xml application/xml application/xml+rss text/javascript;
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>##
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#75715e># Virtual Host Configs
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#75715e>##
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>include</span> <span style=color:#e6db74>/etc/nginx/conf.d/*.conf</span>;
</span></span><span style=display:flex><span>	<span style=color:#f92672>include</span> <span style=color:#e6db74>/etc/nginx/sites-enabled/*</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h6 id=matomoconf>matomo.conf</h6><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nginx data-lang=nginx><span style=display:flex><span><span style=color:#66d9ef>server</span> {
</span></span><span style=display:flex><span>    <span style=color:#f92672>listen</span> <span style=color:#ae81ff>80</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>server_name</span> <span style=color:#e6db74>analytics.matomo.cc</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>root</span> <span style=color:#e6db74>/var/www/html/matomo</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>index</span> <span style=color:#e6db74>index.php</span> <span style=color:#e6db74>index.html</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>access_log</span> <span style=color:#e6db74>/var/log/nginx/matomo.access.log</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>error_log</span>  <span style=color:#e6db74>/var/log/nginx/matomo.error.log</span> <span style=color:#e6db74>warn</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>location</span> <span style=color:#e6db74>/</span> {
</span></span><span style=display:flex><span>        <span style=color:#f92672>try_files</span> $uri $uri/ =<span style=color:#ae81ff>404</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># Matomo Rewrite for pretty URLs
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#f92672>location</span> ~ <span style=color:#e6db74>^/(index|piwik|matomo)\.php(/|$)</span> {
</span></span><span style=display:flex><span>        <span style=color:#f92672>fastcgi_split_path_info</span> <span style=color:#e6db74>^(.+\.php)(/.*)</span>$;
</span></span><span style=display:flex><span>        <span style=color:#f92672>fastcgi_pass</span> <span style=color:#e6db74>unix:/run/php/php8.1-fpm.sock</span>;
</span></span><span style=display:flex><span>        <span style=color:#f92672>include</span> <span style=color:#e6db74>fastcgi_params</span>;
</span></span><span style=display:flex><span>        <span style=color:#f92672>fastcgi_param</span> <span style=color:#e6db74>PATH_INFO</span> $fastcgi_path_info;
</span></span><span style=display:flex><span>        <span style=color:#f92672>fastcgi_param</span> <span style=color:#e6db74>SCRIPT_FILENAME</span> $document_root$fastcgi_script_name;
</span></span><span style=display:flex><span>        <span style=color:#f92672>fastcgi_param</span> <span style=color:#e6db74>HTTPS</span> <span style=color:#66d9ef>off</span>;
</span></span><span style=display:flex><span>        <span style=color:#75715e># 緩衝區
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#f92672>fastcgi_buffers</span>           <span style=color:#ae81ff>16</span> <span style=color:#ae81ff>16k</span>;
</span></span><span style=display:flex><span>        <span style=color:#f92672>fastcgi_buffer_size</span>       <span style=color:#ae81ff>32k</span>;
</span></span><span style=display:flex><span>        <span style=color:#f92672>fastcgi_busy_buffers_size</span> <span style=color:#ae81ff>64k</span>;
</span></span><span style=display:flex><span>        <span style=color:#f92672>fastcgi_temp_file_write_size</span> <span style=color:#ae81ff>64k</span>;
</span></span><span style=display:flex><span>        <span style=color:#75715e># 逾時
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#f92672>fastcgi_read_timeout</span> <span style=color:#ae81ff>300</span>;
</span></span><span style=display:flex><span>        <span style=color:#f92672>fastcgi_connect_timeout</span> <span style=color:#ae81ff>60</span>;
</span></span><span style=display:flex><span>        <span style=color:#f92672>fastcgi_send_timeout</span>    <span style=color:#ae81ff>60</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e># 加速 HEAD 請求
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#f92672>fastcgi_ignore_headers</span>  <span style=color:#e6db74>X-Accel-Buffering</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># 靜態檔案快取
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#f92672>location</span> ~<span style=color:#e6db74>*</span> <span style=color:#e6db74>\.(js|woff2?|ttf|css|png|jpg|jpeg|gif|ico|svg)</span>$ {
</span></span><span style=display:flex><span>        <span style=color:#f92672>expires</span> <span style=color:#e6db74>max</span>;
</span></span><span style=display:flex><span>	<span style=color:#f92672>access_log</span> <span style=color:#66d9ef>off</span>;
</span></span><span style=display:flex><span>        <span style=color:#f92672>log_not_found</span> <span style=color:#66d9ef>off</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># 安全：拒絕存取 .ht*
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#f92672>location</span> ~ <span style=color:#e6db74>/\.ht</span> {
</span></span><span style=display:flex><span>        <span style=color:#f92672>deny</span> <span style=color:#e6db74>all</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h6 id=crontab>crontab</h6><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>*/5 * * * * php /var/www/html/matomo/console core:archive --force-all-websites &gt; /var/log/matomo-archive.log 2&gt;&amp;<span style=color:#ae81ff>1</span>
</span></span></code></pre></div></div></div></div></div><div class=note-card><div class=item><h5 class=note-title><span>MySQL</span></h5><div class=card><div class=card-body><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ini data-lang=ini><span style=display:flex><span><span style=color:#75715e># 臨時表大小 - 可以設定更大</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>tmp_table_size</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>2147483648      # 2GB (約記憶體的3-4%)</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>max_heap_table_size</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>2147483648 # 2GB (必須與 tmp_table_size 相同)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 排序緩衝區 - 每個連線獨立使用</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>sort_buffer_size</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>4194304       # 4MB (不要太大，會佔用過多記憶體)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 讀取緩衝區</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>read_buffer_size</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>2097152       # 2MB (你的設定已經合適)</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>read_rnd_buffer_size</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>8388608   # 8MB (可以稍微增大)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 連線緩衝區</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>join_buffer_size</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>8388608       # 8MB</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>bulk_insert_buffer_size</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>67108864 # 64MB</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># InnoDB 相關</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>innodb_buffer_pool_size</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>42949672960  # 40GB (約記憶體的60-65%)</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>innodb_log_file_size</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>2147483648      # 2GB</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>innodb_log_buffer_size</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>67108864      # 64MB</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 設定原則</span>
</span></span><span style=display:flex><span><span style=color:#75715e># tmp_table_size &amp; max_heap_table_size：</span>
</span></span><span style=display:flex><span><span style=color:#75715e># 這兩個參數必須相同</span>
</span></span><span style=display:flex><span><span style=color:#75715e># 建議設定為記憶體的 2-4%</span>
</span></span><span style=display:flex><span><span style=color:#75715e># 64GB 機器建議 1-2GB</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># sort_buffer_size：</span>
</span></span><span style=display:flex><span><span style=color:#75715e># 每個連線都會分配，不要設太大</span>
</span></span><span style=display:flex><span><span style=color:#75715e># 建議 2-8MB，你的 2MB 其實已經合適</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># innodb_buffer_pool_size：</span>
</span></span><span style=display:flex><span><span style=color:#75715e># 最重要的參數</span>
</span></span><span style=display:flex><span><span style=color:#75715e># 建議設定為記憶體的 60-70%</span>
</span></span><span style=display:flex><span><span style=color:#75715e># 64GB 機器建議 38-42GB</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># TempTable Storage Engine 參數（MySQL 8.0 關鍵）</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>temptable_max_ram</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>4294967296      # 4GB（記憶體中臨時表）</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>temptable_max_mmap</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>42949672960    # 40GB（記憶體映射檔案）</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>temptable_use_mmap</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>1              # 啟用記憶體映射</span>
</span></span></code></pre></div></div></div></div></div><div class=note-card><div class=item><h5 class=note-title><span>v2ray</span></h5><div class=card><div class=card-body><h6 id=supervisordconf>supervisord.conf</h6><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ini data-lang=ini><span style=display:flex><span><span style=color:#75715e>; supervisor config file</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>[unix_http_server]</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>file</span><span style=color:#f92672>=</span><span style=color:#e6db74>/var/run/supervisor.sock   ; (the path to the socket file)</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>chmod</span><span style=color:#f92672>=</span><span style=color:#e6db74>0700                       ; sockef file mode (default 0700)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>[supervisord]</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>logfile</span><span style=color:#f92672>=</span><span style=color:#e6db74>/var/log/supervisor/supervisord.log ; (main log file;default $CWD/supervisord.log)</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>pidfile</span><span style=color:#f92672>=</span><span style=color:#e6db74>/var/run/supervisord.pid ; (supervisord pidfile;default supervisord.pid)</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>childlogdir</span><span style=color:#f92672>=</span><span style=color:#e6db74>/var/log/supervisor            ; (&#39;AUTO&#39; child log dir, default $TEMP)</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>logfileMaxbytes</span><span style=color:#f92672>=</span><span style=color:#e6db74>100MB</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>logfileBackups</span><span style=color:#f92672>=</span><span style=color:#e6db74>50</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>loglevel</span><span style=color:#f92672>=</span><span style=color:#e6db74>debug</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>; the below section must remain in the config file for RPC</span>
</span></span><span style=display:flex><span><span style=color:#75715e>; (supervisorctl/web interface) to work, additional interfaces may be</span>
</span></span><span style=display:flex><span><span style=color:#75715e>; added by defining them in separate rpcinterface: sections</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>[rpcinterface:supervisor]</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>supervisor.rpcinterface_factory</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>supervisor.rpcinterface:make_main_rpcinterface</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>[supervisorctl]</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>serverurl</span><span style=color:#f92672>=</span><span style=color:#e6db74>unix:///var/run/supervisor.sock ; use a unix:// URL  for a unix socket</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>; The [include] section can just contain the &#34;files&#34; setting.  This</span>
</span></span><span style=display:flex><span><span style=color:#75715e>; setting can list multiple files (separated by whitespace or</span>
</span></span><span style=display:flex><span><span style=color:#75715e>; newlines).  It can also contain wildcards.  The filenames are</span>
</span></span><span style=display:flex><span><span style=color:#75715e>; interpreted as relative to this file.  Included files *cannot*</span>
</span></span><span style=display:flex><span><span style=color:#75715e>; include files themselves.</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>[include]</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>files</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>/etc/supervisor/conf.d/*.conf</span>
</span></span></code></pre></div><h6 id=confdv2rayconf>conf.d/v2ray.conf</h6><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ini data-lang=ini><span style=display:flex><span><span style=color:#66d9ef>[program:v2ray]</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>command</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>/etc/v2ray/bin/v2ray run -config /etc/v2ray/config.json -confdir /etc/v2ray/conf</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>process_name</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>v2ray</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>stdout_logfile</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>/var/log/supervisor/v2ray.log</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>stderr_logfile</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>/var/log/supervisor/v2ray.log</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>autostart</span><span style=color:#f92672>=</span><span style=color:#e6db74>true</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>startsecs</span><span style=color:#f92672>=</span><span style=color:#e6db74>3</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>startretries</span><span style=color:#f92672>=</span><span style=color:#e6db74>3</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>autorestart</span><span style=color:#f92672>=</span><span style=color:#e6db74>true</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>exitcodes</span><span style=color:#f92672>=</span><span style=color:#e6db74>0</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>stopsignal</span><span style=color:#f92672>=</span><span style=color:#e6db74>TERM</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>stopwaitsecs</span><span style=color:#f92672>=</span><span style=color:#e6db74>10</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>stopasgroup</span><span style=color:#f92672>=</span><span style=color:#e6db74>true</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>killasgroup</span><span style=color:#f92672>=</span><span style=color:#e6db74>true</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>[program:caddy]</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>command</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>/usr/local/bin/caddy run --environ --config /etc/caddy/Caddyfile --adapter caddyfile</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>process_name</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>caddy</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>stdout_logfile</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>/var/log/supervisor/caddy.log</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>stderr_logfile</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>/var/log/supervisor/caddy.log</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>autostart</span><span style=color:#f92672>=</span><span style=color:#e6db74>true</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>startsecs</span><span style=color:#f92672>=</span><span style=color:#e6db74>3</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>startretries</span><span style=color:#f92672>=</span><span style=color:#e6db74>3</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>autorestart</span><span style=color:#f92672>=</span><span style=color:#e6db74>true</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>exitcodes</span><span style=color:#f92672>=</span><span style=color:#e6db74>0</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>stopsignal</span><span style=color:#f92672>=</span><span style=color:#e6db74>TERM</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>stopwaitsecs</span><span style=color:#f92672>=</span><span style=color:#e6db74>10</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>stopasgroup</span><span style=color:#f92672>=</span><span style=color:#e6db74>true</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>killasgroup</span><span style=color:#f92672>=</span><span style=color:#e6db74>true</span>
</span></span></code></pre></div></div></div></div></div></div></div></section></div><footer id=footer class="container-fluid text-center align-content-center footer pb-2"><div class="container pt-5"><div class="row text-start"><div class="col-md-4 col-sm-12"><h5>導覽列</h5><ul><li class=nav-item><a class=smooth-scroll href=https://linzeyan.github.io/zh-tw/#about>關於</a></li><li class=nav-item><a class=smooth-scroll href=https://linzeyan.github.io/zh-tw/#skills>技能</a></li><li class=nav-item><a class=smooth-scroll href=https://linzeyan.github.io/zh-tw/#experiences>經歷</a></li><li class=nav-item><a class=smooth-scroll href=https://linzeyan.github.io/zh-tw/#education>學歷</a></li><li class=nav-item><a class=smooth-scroll href=https://linzeyan.github.io/zh-tw/#projects>專案</a></li></ul></div><div class="col-md-4 col-sm-12"><h5>聯絡方式:</h5><ul><li><a href=mailto:zeyanlin@outlook.com target=_blank rel=noopener><span><i class="fas fa-envelope"></i></span> <span>zeyanlin@outlook.com</span></a></li><li><a href=https://github.com/linzeyan target=_blank rel=noopener><span><i class="fab fa-github"></i></span> <span>linzeyan</span></a></li><li><a href=https://line.me/ti/p/m7ME9ChZXV target=_blank rel=noopener><span><i class="fab fa-fab fa-line"></i></span> <span>Ricky</span></a></li><li><a href=https://www.strava.com/athletes/rickylin target=_blank rel=noopener><span><i class="fab fa-fab fa-strava"></i></span> <span>Ricky</span></a></li><li><a href=https://t.me/ricky_lin target=_blank rel=noopener><span><i class="fab fa-fab fa-telegram"></i></span> <span>Ricky</span></a></li></ul></div></div></div></footer><script src=/application.eed5c22001d7c9cc6de7d8db62219c198319957fa017da141928bee1c40883b4.js integrity="sha256-7tXCIAHXycxt59jbYiGcGYMZlX+gF9oUGSi+4cQIg7Q=" defer></script></body></html>