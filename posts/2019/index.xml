<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>2019 on Ricky</title><link>https://linzeyan.github.io/posts/2019/</link><description>Recent content in 2019 on Ricky</description><generator>Hugo -- gohugo.io</generator><language>en</language><lastBuildDate>Mon, 30 Dec 2019 14:31:45 +0800</lastBuildDate><atom:link href="https://linzeyan.github.io/posts/2019/index.xml" rel="self" type="application/rss+xml"/><item><title>Bash è„šæœ¬å¦‚ä½•åˆ›å»ºä¸´æ—¶æ–‡ä»¶ï¼šmktemp å‘½ä»¤å’Œ trap å‘½ä»¤æ•™ç¨‹</title><link>https://linzeyan.github.io/posts/2019/20191230-mktemp/</link><pubDate>Mon, 30 Dec 2019 14:31:45 +0800</pubDate><guid>https://linzeyan.github.io/posts/2019/20191230-mktemp/</guid><description>&lt;ul>
&lt;li>&lt;a href="http://www.ruanyifeng.com/blog/2019/12/mktemp.html" target="_blank" rel="noopener">Bash è„šæœ¬å¦‚ä½•åˆ›å»ºä¸´æ—¶æ–‡ä»¶ï¼šmktemp å‘½ä»¤å’Œ trap å‘½ä»¤æ•™ç¨‹&lt;/a>&lt;/li>
&lt;/ul>
&lt;h4 id="mktemp-å‘½ä»¤">&lt;code>mktemp&lt;/code> å‘½ä»¤&lt;/h4>
&lt;ul>
&lt;li>ç”Ÿæˆçš„ä¸´æ—¶æ–‡ä»¶åæ˜¯éšæœºçš„ï¼Œè€Œä¸”æƒé™æ˜¯åªæœ‰ç”¨æˆ·æœ¬äººå¯è¯»å†™&lt;/li>
&lt;li>ä¸ºäº†ç¡®ä¿ä¸´æ—¶æ–‡ä»¶åˆ›å»ºæˆåŠŸï¼Œ&lt;code>mktemp&lt;/code> å‘½ä»¤åé¢æœ€å¥½ä½¿ç”¨ OR è¿ç®—ç¬¦ï¼ˆ&lt;code>||&lt;/code>ï¼‰ï¼ŒæŒ‡å®šåˆ›å»ºå¤±è´¥æ—¶é€€å‡ºè„šæœ¬&lt;/li>
&lt;li>ä¸ºäº†ä¿è¯è„šæœ¬é€€å‡ºæ—¶ä¸´æ—¶æ–‡ä»¶è¢«åˆ é™¤ï¼Œå¯ä»¥ä½¿ç”¨&lt;code>trap&lt;/code>å‘½ä»¤æŒ‡å®šé€€å‡ºæ—¶çš„æ¸…é™¤æ“ä½œ&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#!/bin/bash
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>trap &lt;span style="color:#e6db74">&amp;#39;rm -f &amp;#34;$TMPFILE&amp;#34;&amp;#39;&lt;/span> EXIT
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>TMPFILE&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#66d9ef">$(&lt;/span>mktemp&lt;span style="color:#66d9ef">)&lt;/span> &lt;span style="color:#f92672">||&lt;/span> exit &lt;span style="color:#ae81ff">1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>echo &lt;span style="color:#e6db74">&amp;#34;Our temp file is &lt;/span>$TMPFILE&lt;span style="color:#e6db74">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="mktemp-å‘½ä»¤çš„å‚æ•°">mktemp å‘½ä»¤çš„å‚æ•°&lt;/h5>
&lt;ul>
&lt;li>&lt;code>-d&lt;/code> å‚æ•°å¯ä»¥åˆ›å»ºä¸€ä¸ªä¸´æ—¶ç›®å½•&lt;/li>
&lt;li>&lt;code>-p&lt;/code> å‚æ•°å¯ä»¥æŒ‡å®šä¸´æ—¶æ–‡ä»¶æ‰€åœ¨çš„ç›®å½•ã€‚é»˜è®¤æ˜¯ä½¿ç”¨ &lt;code>$TMPDIR&lt;/code> ç¯å¢ƒå˜é‡æŒ‡å®šçš„ç›®å½•ï¼Œå¦‚æœè¿™ä¸ªå˜é‡æ²¡è®¾ç½®ï¼Œé‚£ä¹ˆä½¿ç”¨ &lt;code>/tmp&lt;/code> ç›®å½•ã€‚&lt;/li>
&lt;li>&lt;code>-t&lt;/code> å‚æ•°å¯ä»¥æŒ‡å®šä¸´æ—¶æ–‡ä»¶çš„æ–‡ä»¶åæ¨¡æ¿ï¼Œæ¨¡æ¿çš„æœ«å°¾å¿…é¡»è‡³å°‘åŒ…å«ä¸‰ä¸ªè¿ç»­çš„ &lt;code>X&lt;/code> å­—ç¬¦ï¼Œè¡¨ç¤ºéšæœºå­—ç¬¦ï¼Œå»ºè®®è‡³å°‘ä½¿ç”¨å…­ä¸ª &lt;code>X&lt;/code>ã€‚é»˜è®¤çš„æ–‡ä»¶åæ¨¡æ¿æ˜¯ &lt;code>tmp.åæ¥åä¸ªéšæœºå­—ç¬¦&lt;/code>&lt;/li>
&lt;/ul>
&lt;h4 id="trap-å‘½ä»¤çš„ç”¨æ³•">&lt;code>trap&lt;/code> å‘½ä»¤çš„ç”¨æ³•&lt;/h4>
&lt;p>trap å‘½ä»¤ç”¨æ¥åœ¨ Bash è„šæœ¬ä¸­å“åº”ç³»ç»Ÿä¿¡å·ã€‚&lt;/p>
&lt;p>æœ€å¸¸è§çš„ç³»ç»Ÿä¿¡å·å°±æ˜¯ SIGINTï¼ˆä¸­æ–­ï¼‰ï¼Œå³æŒ‰ Ctrl + C æ‰€äº§ç”Ÿçš„ä¿¡å·ã€‚trap å‘½ä»¤çš„-l å‚æ•°ï¼Œå¯ä»¥åˆ—å‡ºæ‰€æœ‰çš„ç³»ç»Ÿä¿¡å·ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>$ trap -l
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> 1&lt;span style="color:#f92672">)&lt;/span> SIGHUP 2&lt;span style="color:#f92672">)&lt;/span> SIGINT 3&lt;span style="color:#f92672">)&lt;/span> SIGQUIT
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> 4&lt;span style="color:#f92672">)&lt;/span> SIGILL 5&lt;span style="color:#f92672">)&lt;/span> SIGTRAP 6&lt;span style="color:#f92672">)&lt;/span> SIGABRT
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ... ...
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>trap çš„å‘½ä»¤æ ¼å¼å¦‚ä¸‹ã€‚&lt;/p></description></item><item><title>GitHub Actions å…¥é—¨æ•™ç¨‹</title><link>https://linzeyan.github.io/posts/2019/20191223-getting-started-with-github-actions/</link><pubDate>Mon, 23 Dec 2019 10:16:01 +0800</pubDate><guid>https://linzeyan.github.io/posts/2019/20191223-getting-started-with-github-actions/</guid><description>&lt;ul>
&lt;li>&lt;a href="http://www.ruanyifeng.com/blog/2019/09/getting-started-with-github-actions.html" target="_blank" rel="noopener">GitHub Actions å…¥é—¨æ•™ç¨‹&lt;/a>&lt;/li>
&lt;/ul></description></item><item><title>Nginxå¦‚ä½•é˜²ç¦¦DDoSæ”»æ“Šï¼Ÿ</title><link>https://linzeyan.github.io/posts/2019/20191220-nginx-defend-ddos/</link><pubDate>Fri, 20 Dec 2019 09:42:50 +0800</pubDate><guid>https://linzeyan.github.io/posts/2019/20191220-nginx-defend-ddos/</guid><description>&lt;ul>
&lt;li>&lt;a href="https://magiclen.org/nginx-defend-ddos/" target="_blank" rel="noopener">Nginx å¦‚ä½•é˜²ç¦¦ DDoS æ”»æ“Šï¼Ÿ&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://www.itread01.com/content/1547474225.html" target="_blank" rel="noopener">Nginx é™åˆ¶è¨ªå•é€Ÿç‡å’Œæœ€å¤§ä½µç™¼é€£ç·šæ•¸æ¨¡çµ„&amp;ndash;limit (é˜²æ­¢ DDOS æ”»æ“Š)&lt;/a>&lt;/li>
&lt;/ul>
&lt;h4 id="ngx_http_limit_req_module">ngx_http_limit_req_module&lt;/h4>
&lt;p>&lt;code>limit_req_zone $binary_remote_addr zone=mylimit:10m rate=10r/s;&lt;/code>&lt;/p></description></item><item><title>golangæœåŠ¡çš„æ–‡ä»¶å¥æŸ„è¶…å‡ºç³»ç»Ÿé™åˆ¶(too many open files)</title><link>https://linzeyan.github.io/posts/2019/20191216-23828/</link><pubDate>Mon, 16 Dec 2019 10:14:33 +0800</pubDate><guid>https://linzeyan.github.io/posts/2019/20191216-23828/</guid><description>&lt;ul>
&lt;li>&lt;a href="https://studygolang.com/articles/23828" target="_blank" rel="noopener">golang æœåŠ¡çš„æ–‡ä»¶å¥æŸ„è¶…å‡ºç³»ç»Ÿé™åˆ¶(too many open files)&lt;/a>&lt;/li>
&lt;/ul>
&lt;ol>
&lt;li>
&lt;p>æŸ¥çœ‹ç³»ç»Ÿçš„é…ç½® &lt;code>ulimit -a | grep open&lt;/code>ï¼Œå‘ç°ç³»ç»Ÿçš„é…ç½®æ­£å¸¸ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>æŸ¥çœ‹ç¨‹åºæœåŠ¡çš„æ‰“å¼€æ–‡ä»¶é™åˆ¶ï¼Œ&lt;code>cat /proc/40636/limits&lt;/code>ï¼Œå‘ç°æœåŠ¡çš„é™åˆ¶å¹¶æ²¡æœ‰ç»§æ‰¿ç³»ç»Ÿè®¾ç½®çš„ï¼Œè¿˜æ˜¯ç³»ç»Ÿé»˜è®¤çš„ 1024 é™åˆ¶ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>æŸ¥çœ‹ç¨‹åºæœåŠ¡æ‰“å¼€æ–‡ä»¶æ•°ï¼ˆè¿æ¥æ•°ï¼‰æƒ…å†µï¼Œ&lt;code>lsof -p 40636 | wc -l&lt;/code>ï¼Œå‘ç°å·²ç»è¶…å‡ºé™åˆ¶ï¼Œæ‰€ä»¥æŠ¥é”™ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å†çœ‹çœ‹ç¨‹åºæœåŠ¡æ‰“å¼€äº†å“ªäº›è¿æ¥ï¼Œ&lt;code>lsof -p 40636 &amp;gt; openfiles.log&lt;/code>ï¼Œå‘ç°å¾ˆå¤š http è¿æ¥æ‰“å¼€æ²¡æœ‰å…³é—­ï¼Œçœ‹ ip æ˜¯æŠ¥è­¦æœåŠ¡çš„æ¥å£ï¼Œäºæ˜¯é¡ºç€è¿™æ¡çº¿ç´¢ï¼Œç»ˆäºæ‰¾åˆ°äº†åŸå› ï¼Œå› ä¸ºç¨‹åºä¸­è¯»å–åˆ°çš„é…ç½®è§£ææ—¶æŠ¥é”™ç»™æŠ¥è­¦æœåŠ¡ï¼Œå¤§é‡çš„æŠ¥è­¦æœåŠ¡è¿æ¥åæœªå…³é—­ï¼Œæ‰å¯¼è‡´çš„ too many open filesï¼Œè¿™æ˜¯é—®é¢˜çš„å…³é”®ï¼Œä½†æ˜¯ç¨‹åºä¸ºä»€ä¹ˆæ²¡æœ‰ç»§æ‰¿ç³»ç»Ÿè®¾ç½®çš„æœ€å¤§é…ç½®é™åˆ¶ï¼Œè¿˜éœ€è¦ç»§ç»­æŸ¥çœ‹ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>æœ€ç»ˆåŸå› æ‰¾åˆ°ï¼Œå› ä¸ºç¨‹åºæœåŠ¡æ˜¯ supervisor ç®¡ç†çš„ï¼Œsupervisor å¯åŠ¨æœåŠ¡é»˜è®¤çš„ minfds é…ç½®æ˜¯ 1024ï¼Œä¹Ÿå°±æ˜¯æ‰“å¼€æ–‡ä»¶é™åˆ¶æ˜¯ 1024ï¼Œåœ¨ supervisor çš„é…ç½®ä¸­åŠ å…¥ &lt;code>minfds=81920&lt;/code>; é‡å¯ &lt;code>supervisorctl reload&lt;/code>ã€‚&lt;/p>
&lt;/li>
&lt;/ol></description></item><item><title>Trellis Ansible Bad Interpreter Error</title><link>https://linzeyan.github.io/posts/2019/20191206-trellis-ansible-bad-interpreter-error/</link><pubDate>Fri, 06 Dec 2019 22:34:31 +0800</pubDate><guid>https://linzeyan.github.io/posts/2019/20191206-trellis-ansible-bad-interpreter-error/</guid><description>&lt;ul>
&lt;li>&lt;a href="https://wpvilla.in/trellis-ansible-bad-interpreter-error/" target="_blank" rel="noopener">Trellis Ansible Bad Interpreter Error&lt;/a>&lt;/li>
&lt;/ul>
&lt;h4 id="bad-interpreter-error">Bad Interpreter Error&lt;/h4>
&lt;p>Error we got using Ansible was a bad interpreter error. Python 2.7 is not to be found:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>zsh: /usr/local/bin/ansible-vault: bad interpreter: /usr/local/opt/python@2/bin/python2.7: no such file or directory
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>And that was correct because when we checked /usr/local/opt we only had Python 3.&lt;/p>
&lt;h4 id="installation-python-2">Installation Python 2&lt;/h4>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>brew install python@2
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="python-crashing-hard">Python Crashing Hard&lt;/h5>
&lt;p>Next, on Ansible version check I got another error&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>âœ trellis git:&lt;span style="color:#f92672">(&lt;/span>master&lt;span style="color:#f92672">)&lt;/span> ansible --version
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">[&lt;/span>1&lt;span style="color:#f92672">]&lt;/span> &lt;span style="color:#ae81ff">19153&lt;/span> abort ansible --version
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>It was somehow crashing Python 2.7 though it should just work with it. I decided to upgrade Ansible as well&lt;/p></description></item><item><title>ç”¨ iptables å’Œ ip rule åšè´Ÿè½½å‡è¡¡</title><link>https://linzeyan.github.io/posts/2019/20191204-ip-tables-rule-load-balance/</link><pubDate>Wed, 04 Dec 2019 11:08:04 +0800</pubDate><guid>https://linzeyan.github.io/posts/2019/20191204-ip-tables-rule-load-balance/</guid><description>&lt;ul>
&lt;li>&lt;a href="https://blog.outv.im/2019/ip-tables-rule-load-balance/" target="_blank" rel="noopener">ç”¨ iptables å’Œ ip rule åšè´Ÿè½½å‡è¡¡&lt;/a>&lt;/li>
&lt;/ul>
&lt;h4 id="æ“ä½œ">æ“ä½œ&lt;/h4>
&lt;p>è¿™é‡Œä»¥ä¸€å°é€šè¿‡æœ‰çº¿ + æ— çº¿å‡ºå£è¿æ¥åˆ°äº’è”ç½‘çš„ Arch Linux è®¾å¤‡ä¸ºä¾‹ã€‚å…¶ä¸­å…±æœ‰ä¸¤ä¸ªå‡ºå£ï¼Œåˆ†åˆ«ä½¿ç”¨ç½‘å¡ eth0 å’Œ eth1ã€‚å¤§æ¦‚çš„å¯¹åº”å…³ç³»æ˜¯ï¼š&lt;/p>
&lt;ul>
&lt;li>æ ‡è®° 10 (0xa) - è·¯ç”±è¡¨ #110 - ä½¿ç”¨ eth0 å‡ºå£&lt;/li>
&lt;li>æ ‡è®° 11 (0xb) - è·¯ç”±è¡¨ #111 - ä½¿ç”¨ eth1 å‡ºå£&lt;/li>
&lt;/ul>
&lt;p>æˆ‘ä»¬ä¼šæ ¹æ®æ•°æ®åŒ…ä¸ŠåŒ…å«çš„æ ‡è®°å€¼æ¥åˆ¤æ–­å®ƒåº”è¯¥èµ°ä»€ä¹ˆå‡ºå£ã€‚é¦–å…ˆï¼Œä½¿ç”¨ ip rule ä¸ºæ¯ä¸ªæ ‡è®°å€¼æŒ‡å®šä¸€å¼ ä½¿ç”¨çš„è·¯ç”±è¡¨ã€‚&lt;/p>
&lt;p>é€šå¸¸é»˜è®¤è·¯ç”±è¡¨çš„æƒé‡æ˜¯ 32768ã€‚ä¸ºäº†è®©æˆ‘ä»¬çš„è·¯ç”±è¡¨ç”¨å¾—ä¸Šï¼Œæˆ‘ä»¬éœ€è¦æŠŠå®ƒä»¬çš„æƒé‡è°ƒå¾—é«˜ä¸€äº›ï¼ˆä¾‹å¦‚ 31000ï¼‰ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># è®©å¸¦æ ‡è®° 10 (0xa) çš„æ•°æ®åŒ…ä½¿ç”¨ 110 å·è·¯ç”±è¡¨ï¼Œæƒé‡ 31000&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>ip rule add fwmark &lt;span style="color:#ae81ff">10&lt;/span> table &lt;span style="color:#ae81ff">110&lt;/span> prio &lt;span style="color:#ae81ff">31000&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># è®©å¸¦æ ‡è®° 11 (0xb) çš„æ•°æ®åŒ…ä½¿ç”¨ 111 å·è·¯ç”±è¡¨ï¼Œæƒé‡ 31000&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>ip rule add fwmark &lt;span style="color:#ae81ff">11&lt;/span> table &lt;span style="color:#ae81ff">111&lt;/span> prio &lt;span style="color:#ae81ff">31000&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># å¦‚æœä½ çš„è¿æ¥æ›´å¤šï¼Œå¯ä»¥ç»§ç»­æ·»åŠ æ ‡è®° &amp;lt;-&amp;gt; è·¯ç”±è¡¨çš„å¯¹åº”å…³ç³»&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># #110 è·¯ç”±è¡¨çš„è·¯ç”±&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>ip route add 10.20.0.0/24 dev eth0 table &lt;span style="color:#ae81ff">110&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>ip route add default via 10.20.0.254 table &lt;span style="color:#ae81ff">110&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># #111 è·¯ç”±è¡¨çš„è·¯ç”±&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>ip route add 10.25.0.0/24 dev eth1 table &lt;span style="color:#ae81ff">111&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>ip route add default via 10.25.0.254 table &lt;span style="color:#ae81ff">111&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># å¦‚æœè¿™æ¡è¿æ¥å·²ç»è¢«æ ‡è®°ï¼Œé‚£ä¹ˆæŠŠæ ‡è®°è®¾ç½®åˆ°æ•°æ®åŒ…ä¸Š&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>iptables -t mangle -A OUTPUT -j CONNMARK --restore-mark
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># å¦‚æœæ•°æ®åŒ…å·²ç»æœ‰æ ‡è®°ï¼Œç›´æ¥æ”¾è¡Œ&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>iptables -t mangle -A OUTPUT -m mark ! --mark &lt;span style="color:#ae81ff">0&lt;/span> -j ACCEPT
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># å¦‚æœæ•°æ®åŒ…æ²¡è¢«æ ‡è®°çš„è¯&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># æŠŠæ•°æ®åŒ…åŒ…çš„æ ‡è®°è®¾ç½®ä¸º 11 (0xb)...&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>iptables -t mangle -A OUTPUT -j MARK --set-mark &lt;span style="color:#ae81ff">10&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># å¹¶ä¸”æ¯ 2 ä¸ªåŒ…å°±æŠŠä¸€ä¸ªåŒ…çš„æ ‡è®°è®¾ç½®ä¸º 10 (0xa)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>iptables -t mangle -A OUTPUT -m statistic --mode nth --every &lt;span style="color:#ae81ff">2&lt;/span> --packet &lt;span style="color:#ae81ff">0&lt;/span> -j MARK --set-mark &lt;span style="color:#ae81ff">11&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># å¦‚æœä½ æœ‰ä¸‰æ¡å‡ºå£çš„è¯ï¼Œè¿™é‡Œå¯ä»¥ç±»ä¼¼äº&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># iptables -t mangle -A OUTPUT -j MARK --set-mark 10&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># iptables -t mangle -A OUTPUT -m statistic --mode nth --every 3 --packet 0 -j MARK --set-mark 11&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># iptables -t mangle -A OUTPUT -m statistic --mode nth --every 3 --packet 1 -j MARK --set-mark 12&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># æŠŠæ•°æ®åŒ…çš„æ ‡è®°å­˜å‚¨åˆ°æ•´æ¡è¿æ¥ä¸Šï¼Œè¿™æ ·æ•´ä¸ªè¿æ¥è¿‡ç¨‹éƒ½ä¼šä½¿ç”¨åŒä¸€æ¡å‡ºå£&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>iptables -t mangle -A OUTPUT -j CONNMARK --save-mark
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># æˆ‘ä»¬è¿˜éœ€è¦è®©æ•°æ®åŒ…ä¸Šæ ‡ç¤ºçš„å‡ºå£æ˜¯æˆ‘ä»¬ä¸ºå…¶é€‰æ‹©çš„å‡ºå£&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>iptables -t nat -A POSTROUTING -o eth1 -j MASQUERADE
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä¹‹åå¯ä»¥ç”¨ &lt;code>iptables -L OUTPUT -t mangle&lt;/code> çœ‹ä¸€ä¸‹è‡ªå·±æ‰€è®¾ç½®çš„è§„åˆ™æ˜¯å¦æ­£ç¡®ã€‚ç„¶åå°±å¯ä»¥ç”¨ Wiresharks çœ‹ä¸€çœ‹è‡ªå·±çš„è¿æ¥æ˜¯ä¸æ˜¯çœŸçš„åˆ†æµå•¦ã€‚&lt;/p></description></item><item><title>htop explained</title><link>https://linzeyan.github.io/posts/2019/20191114-htop/</link><pubDate>Thu, 14 Nov 2019 10:05:35 +0800</pubDate><guid>https://linzeyan.github.io/posts/2019/20191114-htop/</guid><description>&lt;ul>
&lt;li>&lt;a href="https://peteris.rocks/blog/htop/" target="_blank" rel="noopener">htop explained&lt;/a>&lt;/li>
&lt;/ul></description></item><item><title>Some Jenkinsfile examples</title><link>https://linzeyan.github.io/posts/2019/20191106-228cdb1893fca91f0663bab7b095757c/</link><pubDate>Wed, 06 Nov 2019 17:29:46 +0800</pubDate><guid>https://linzeyan.github.io/posts/2019/20191106-228cdb1893fca91f0663bab7b095757c/</guid><description>&lt;ul>
&lt;li>&lt;a href="https://gist.github.com/merikan/228cdb1893fca91f0663bab7b095757c" target="_blank" rel="noopener">Some Jenkinsfile examples&lt;/a>&lt;/li>
&lt;/ul>
&lt;h5 id="parallel">Parallel&lt;/h5>
&lt;pre tabindex="0">&lt;code>#!/usr/bin/env groovy
pipeline {
agent any
stages {
stage(&amp;#34;Build&amp;#34;) {
steps {
sh &amp;#39;mvn -v&amp;#39;
}
}
stage(&amp;#34;Testing&amp;#34;) {
parallel {
stage(&amp;#34;Unit Tests&amp;#34;) {
agent { docker &amp;#39;openjdk:7-jdk-alpine&amp;#39; }
steps {
sh &amp;#39;java -version&amp;#39;
}
}
stage(&amp;#34;Functional Tests&amp;#34;) {
agent { docker &amp;#39;openjdk:8-jdk-alpine&amp;#39; }
steps {
sh &amp;#39;java -version&amp;#39;
}
}
stage(&amp;#34;Integration Tests&amp;#34;) {
steps {
sh &amp;#39;java -version&amp;#39;
}
}
}
}
stage(&amp;#34;Deploy&amp;#34;) {
steps {
echo &amp;#34;Deploy!&amp;#34;
}
}
}
}
&lt;/code>&lt;/pre>&lt;h5 id="when">When&lt;/h5>
&lt;pre tabindex="0">&lt;code>#!/usr/bin/env groovy
pipeline {
agent any
environment {
VALUE_ONE = &amp;#39;1&amp;#39;
VALUE_TWO = &amp;#39;2&amp;#39;
VALUE_THREE = &amp;#39;3&amp;#39;
}
stages {
// skip a stage while creating the pipeline
stage(&amp;#34;A stage to be skipped&amp;#34;) {
when {
expression { false } //skip this stage
}
steps {
echo &amp;#39;This step will never be run&amp;#39;
}
}
// Execute when branch = &amp;#39;master&amp;#39;
stage(&amp;#34;BASIC WHEN - Branch&amp;#34;) {
when {
branch &amp;#39;master&amp;#39;
}
steps {
echo &amp;#39;BASIC WHEN - Master Branch!&amp;#39;
}
}
// Expression based when example with AND
stage(&amp;#39;WHEN EXPRESSION with AND&amp;#39;) {
when {
expression {
VALUE_ONE == &amp;#39;1&amp;#39; &amp;amp;&amp;amp; VALUE_THREE == &amp;#39;3&amp;#39;
}
}
steps {
echo &amp;#39;WHEN with AND expression works!&amp;#39;
}
}
// Expression based when example
stage(&amp;#39;WHEN EXPRESSION with OR&amp;#39;) {
when {
expression {
VALUE_ONE == &amp;#39;1&amp;#39; || VALUE_THREE == &amp;#39;2&amp;#39;
}
}
steps {
echo &amp;#39;WHEN with OR expression works!&amp;#39;
}
}
// When - AllOf Example
stage(&amp;#34;AllOf&amp;#34;) {
when {
allOf {
environment name:&amp;#39;VALUE_ONE&amp;#39;, value: &amp;#39;1&amp;#39;
environment name:&amp;#39;VALUE_TWO&amp;#39;, value: &amp;#39;2&amp;#39;
}
}
steps {
echo &amp;#34;AllOf Works!!&amp;#34;
}
}
// When - Not AnyOf Example
stage(&amp;#34;Not AnyOf&amp;#34;) {
when {
not {
anyOf {
branch &amp;#34;development&amp;#34;
environment name:&amp;#39;VALUE_TWO&amp;#39;, value: &amp;#39;4&amp;#39;
}
}
}
steps {
echo &amp;#34;Not AnyOf - Works!&amp;#34;
}
}
}
}
&lt;/code>&lt;/pre></description></item><item><title>Jinja docx template, avoiding new line in nested for</title><link>https://linzeyan.github.io/posts/2019/20191029-jinja-docx-template-avoiding-new-line-in-nested-for/</link><pubDate>Tue, 29 Oct 2019 10:17:35 +0800</pubDate><guid>https://linzeyan.github.io/posts/2019/20191029-jinja-docx-template-avoiding-new-line-in-nested-for/</guid><description>&lt;ul>
&lt;li>&lt;a href="https://stackoverflow.com/questions/45719062/jinja-docx-template-avoiding-new-line-in-nested-for#_=_" target="_blank" rel="noopener">Jinja docx template, avoiding new line in nested for&lt;/a>&lt;/li>
&lt;/ul></description></item><item><title>What the f*ck Python! ğŸ</title><link>https://linzeyan.github.io/posts/2019/20191011-wtfpython-cn/</link><pubDate>Fri, 11 Oct 2019 14:32:20 +0800</pubDate><guid>https://linzeyan.github.io/posts/2019/20191011-wtfpython-cn/</guid><description>&lt;ul>
&lt;li>&lt;a href="https://github.com/leisurelicht/wtfpython-cn" target="_blank" rel="noopener">What the f*ck Python! ğŸ&lt;/a>&lt;/li>
&lt;/ul></description></item><item><title>å†æˆ˜è¿è¥å•†ç¼“å­˜ä¹‹ ä½¿ç”¨ iptables å¯¹ä»˜æ­» X ç¼“å­˜åŠ«æŒ</title><link>https://linzeyan.github.io/posts/2019/20191007-fuck-cmcc/</link><pubDate>Mon, 07 Oct 2019 10:41:08 +0800</pubDate><guid>https://linzeyan.github.io/posts/2019/20191007-fuck-cmcc/</guid><description>&lt;ul>
&lt;li>&lt;a href="https://v2c.tech/Article/FUCK-CMCC" target="_blank" rel="noopener">å†æˆ˜è¿è¥å•†ç¼“å­˜ä¹‹ ä½¿ç”¨ iptables å¯¹ä»˜æ­» X ç¼“å­˜åŠ«æŒ&lt;/a>&lt;/li>
&lt;/ul>
&lt;h5 id="èµ·å› ">èµ·å› &lt;/h5>
&lt;p>ä¸ç§»åŠ¨çš„ç¼“å­˜é—®é¢˜è¿›è¡Œæ–—äº‰è¦è¿½æº¯åˆ°ä¸¤å¹´å‰ï¼Œé‚£æ—¶å€™å› ä¸ºç§»åŠ¨ç«Ÿç„¶è¿ cnpm çš„æ•°æ®éƒ½è¿›è¡Œç¼“å­˜ã€‚å¹¶ä¸”ä»¤äººå–·é¥­çš„æ˜¯ï¼šç§»åŠ¨çš„ç¼“å­˜æœåŠ¡å™¨ä¸ä½†ç»å¸¸é€Ÿåº¦æ…¢åˆ°å ªæ¯”ä¸‡å¹´ç‹å…«è·‘é©¬æ‹‰æ¾ï¼Œç”šè‡³è¿˜ç»å¸¸å®•æœºï¼Œå¯¼è‡´æˆ‘åªæƒ³å®‰å®‰é™é™çš„å†™ä¸ªä»£ç å´ä¸å¾—ä¸é¢å¯¹ä¸€ç‰‡é²œçº¢çš„æŠ¥é”™&lt;/p>
&lt;h5 id="è§£å†³">è§£å†³&lt;/h5>
&lt;p>&lt;code>iptables -I FORWARD -p tcp -m tcp -m ttl --ttl-gt 20 -m ttl --ttl-lt 30 -j DROP&lt;/code>&lt;/p>
&lt;p>è€ƒè™‘åˆ°å¯èƒ½è¿˜çœŸçš„æœ‰å…¶ä»–å¹ºè›¾å­æœåŠ¡å™¨å‘æ¥çš„çœŸå®æ•°æ®åŒ…çš„ TTL ä¹Ÿåœ¨ 20-30 çš„åŒºé—´èŒƒå›´å†…ï¼Œåº”è¯¥å†åŠ ä¸€å±‚åˆ¤æ–­ã€‚å¯¹æ¯”äº†ç§»åŠ¨çš„ 302 åŠ«æŒåŒ…å’Œæ­£å¸¸çš„ 302 è·³è½¬åŒ…çš„æŠ¥æ–‡åï¼Œå‘ç°ç§»åŠ¨çš„åŠ«æŒåŒ…çš„çŠ¶æ€ä½åŒ…å« FIN, PSH, ACK è€Œæ­£å¸¸çš„ 302 è·³è½¬åŒ…ä¸€èˆ¬ä¸ä¼šè¿™ä¸‰ä¸ªéƒ½æœ‰&lt;/p>
&lt;p>é‚£ä¹ˆå°±åœ¨ iptables è§„åˆ™é‡ŒåŠ ä¸ŠçŠ¶æ€ä½æ˜¯å¦åŒ…å« FIN, PSH, ACK çš„åˆ¤æ–­ï¼š&lt;/p>
&lt;p>&lt;code>iptables -I FORWARD -p tcp -m tcp -m ttl --ttl-gt 20 -m ttl --ttl-lt 30 --tcp-flags ALL FIN,PSH,ACK -j DROP&lt;/code>&lt;/p></description></item><item><title>ä½¿ç”¨ Nginx å’Œ mod_pagespeed è‡ªåŠ¨å°†å›¾ç‰‡è½¬æ¢ä¸º WebP å¹¶è¾“å‡º</title><link>https://linzeyan.github.io/posts/2019/20191007-serve-webp-on-the-fly-with-nginx-and-mod_pagespeed/</link><pubDate>Mon, 07 Oct 2019 10:35:22 +0800</pubDate><guid>https://linzeyan.github.io/posts/2019/20191007-serve-webp-on-the-fly-with-nginx-and-mod_pagespeed/</guid><description>&lt;ul>
&lt;li>&lt;a href="https://nova.moe/serve-webp-on-the-fly-with-nginx-and-mod_pagespeed/" target="_blank" rel="noopener">ä½¿ç”¨ Nginx å’Œ mod_pagespeed è‡ªåŠ¨å°†å›¾ç‰‡è½¬æ¢ä¸º WebP å¹¶è¾“å‡º&lt;/a>&lt;/li>
&lt;/ul>
&lt;h4 id="ç¼–è¯‘-ngx_pagespeed">ç¼–è¯‘ ngx_pagespeed&lt;/h4>
&lt;blockquote>
&lt;p>é¦–å…ˆç¡®ä¿ Nginx æœ‰ &lt;code>--with-compat&lt;/code> ç¼–è¯‘å‚æ•°ï¼Œè¿™æ ·æˆ‘ä»¬å°±ä¸éœ€è¦æŒ‰ç…§ä¸€äº›å¥‡æ€ªçš„æ•™ç¨‹è®©å¤§å®¶ä»å¤´å¼€å§‹ç¼–è¯‘ Nginx&lt;/p>
&lt;p>incubator: &lt;a href="https://github.com/apache/incubator-pagespeed-ngx.git" target="_blank" rel="noopener">https://github.com/apache/incubator-pagespeed-ngx.git&lt;/a>&lt;/p>&lt;/blockquote>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># åˆ‡æ¢åˆ° nginx æºä»£ç ç›®å½•ä¸‹å¼€å§‹é…ç½®ç¼–è¯‘ç¯å¢ƒ&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>./configure --with-compat --add-dynamic-module&lt;span style="color:#f92672">=&lt;/span>../incubator-pagespeed-ngx
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># ç¼–è¯‘ modules&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>make modules
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># å°†å¯¹åº”ç¼–è¯‘å¥½çš„ module æ”¾åˆ° nginx ç›®å½•ä¸‹ï¼š&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>sudo cp objs/ngx_pagespeed.so /etc/nginx/modules/
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># åˆ›å»ºå¥½ç¼“å­˜æ–‡ä»¶å¤¹ä»¥ä¾¿å­˜æ”¾è‡ªåŠ¨è½¬æ¢çš„å›¾ç‰‡&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>sudo mkdir -p /var/ngx_pagespeed_cache
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>sudo chown -R www-data:www-data /var/ngx_pagespeed_cache
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-nginx" data-lang="nginx">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">load_module&lt;/span> &lt;span style="color:#e6db74">modules/ngx_pagespeed.so&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># enable pagespeed module on this server block
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">pagespeed&lt;/span> &lt;span style="color:#66d9ef">on&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># Needs to exist and be writable by nginx. Use tmpfs for best performance.
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">pagespeed&lt;/span> &lt;span style="color:#e6db74">FileCachePath&lt;/span> &lt;span style="color:#e6db74">/var/ngx_pagespeed_cache&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># Ensure requests for pagespeed optimized resources go to the pagespeed handler
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># and no extraneous headers get set.
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">location&lt;/span> ~ &lt;span style="color:#e6db74">&amp;#34;\.pagespeed\.([a-z]\.)?[a-z]&lt;/span>{&lt;span style="color:#f92672">2}\.[^.]{10}\.[^.]+&amp;#34;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">add_header&lt;/span> &lt;span style="color:#e6db74">&amp;#34;&amp;#34;&lt;/span> &lt;span style="color:#e6db74">&amp;#34;&amp;#34;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">location&lt;/span> ~ &lt;span style="color:#e6db74">&amp;#34;^/pagespeed_static/&amp;#34;&lt;/span> { }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">location&lt;/span> ~ &lt;span style="color:#e6db74">&amp;#34;^/ngx_pagespeed_beacon$&amp;#34;&lt;/span> { }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">pagespeed&lt;/span> &lt;span style="color:#e6db74">RewriteLevel&lt;/span> &lt;span style="color:#e6db74">CoreFilters&lt;/span>;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å…¶ä¸­æœ€åä¸€ä¸ªéƒ¨åˆ†ï¼ˆ&lt;code>pagespeed RewriteLevel CoreFilters;&lt;/code>ï¼‰è¡¨ç¤ºå¯ç”¨çš„ä¼˜åŒ–æ–¹å¼ï¼Œå…¶ä¸­åŒ…æ‹¬äº†ä¸€äº›åŸºç¡€çš„ä¼˜åŒ–ï¼Œæ¯”å¦‚&lt;/p></description></item><item><title>Is there a regular expression to detect a valid regular expression?</title><link>https://linzeyan.github.io/posts/2019/20191004-is-there-a-regular-expression-to-detect-a-valid-regular-expression/</link><pubDate>Fri, 04 Oct 2019 14:44:38 +0800</pubDate><guid>https://linzeyan.github.io/posts/2019/20191004-is-there-a-regular-expression-to-detect-a-valid-regular-expression/</guid><description>&lt;ul>
&lt;li>&lt;a href="https://stackoverflow.com/questions/172303/is-there-a-regular-expression-to-detect-a-valid-regular-expression" target="_blank" rel="noopener">Is there a regular expression to detect a valid regular expression?&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>This is a recursive regex, and is not supported by many regex engines. PCRE based ones should support it.&lt;/p>
&lt;pre tabindex="0">&lt;code>/
^ # start of string
( # first group start
(?:
(?:[^?+*{}()[\]\\|]+ # literals and ^, $
| \\. # escaped characters
| \[ (?: \^?\\. | \^[^\\] | [^\\^] ) # character classes
(?: [^\]\\]+ | \\. )* \]
| \( (?:\?[:=!]|\?&amp;lt;[=!]|\?&amp;gt;)? (?1)?? \) # parenthesis, with recursive content
| \(\? (?:R|[+-]?\d+) \) # recursive matching
)
(?: (?:[?+*]|\{\d+(?:,\d*)?\}) [?+]? )? # quantifiers
| \| # alternative
)* # repeat content
) # end first group
$ # end of string
/
&lt;/code>&lt;/pre>&lt;p>Without whitespace and comments&lt;/p></description></item><item><title>Force file download with Nginx</title><link>https://linzeyan.github.io/posts/2019/20190819-force-file-download-with-nginx/</link><pubDate>Mon, 19 Aug 2019 12:12:32 +0800</pubDate><guid>https://linzeyan.github.io/posts/2019/20190819-force-file-download-with-nginx/</guid><description>&lt;ul>
&lt;li>&lt;a href="https://coderwall.com/p/3yb8vg/force-file-download-with-nginx" target="_blank" rel="noopener">Force file download with Nginx&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>&lt;code>add_header Content-Disposition 'attachment;';&lt;/code>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-nginx" data-lang="nginx">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">server&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">listen&lt;/span> &lt;span style="color:#ae81ff">80&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">server_name&lt;/span> &lt;span style="color:#e6db74">my.domain.com&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">location&lt;/span> ~ &lt;span style="color:#e6db74">^.*/(?P&amp;lt;request_basename&amp;gt;[^/]+\.(mp3))$&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">root&lt;/span> &lt;span style="color:#e6db74">/path/to/mp3/&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">add_header&lt;/span> &lt;span style="color:#e6db74">Content-Disposition&lt;/span> &lt;span style="color:#e6db74">&amp;#39;attachment&lt;/span>; &lt;span style="color:#f92672">filename=&amp;#34;$request_basename&amp;#34;&amp;#39;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-nginx" data-lang="nginx">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">listen&lt;/span> &lt;span style="color:#ae81ff">80&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">server_name&lt;/span> &lt;span style="color:#e6db74">backup.baifu-tech.net&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">root&lt;/span> &lt;span style="color:#e6db74">/data/backup/rechargecent-mago&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">location&lt;/span> &lt;span style="color:#e6db74">/&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">auth_basic&lt;/span> &lt;span style="color:#e6db74">&amp;#34;baifu&lt;/span> &lt;span style="color:#e6db74">backup&lt;/span> &lt;span style="color:#e6db74">center&amp;#34;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">auth_basic_user_file&lt;/span> &lt;span style="color:#e6db74">/etc/nginx/ssl/htpasswd&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">autoindex&lt;/span> &lt;span style="color:#66d9ef">on&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">autoindex_exact_size&lt;/span> &lt;span style="color:#66d9ef">off&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">autoindex_localtime&lt;/span> &lt;span style="color:#66d9ef">on&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>Shellè„šæœ¬å­¦ä¹ ç¬”è®°</title><link>https://linzeyan.github.io/posts/2019/20190807-mylxsw-growing-up-shell/</link><pubDate>Wed, 07 Aug 2019 15:14:08 +0800</pubDate><guid>https://linzeyan.github.io/posts/2019/20190807-mylxsw-growing-up-shell/</guid><description>&lt;ul>
&lt;li>&lt;a href="https://github.com/mylxsw/growing-up/blob/master/doc/Shell%E8%84%9A%E6%9C%AC%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0.md" target="_blank" rel="noopener">Shell è„šæœ¬å­¦ä¹ ç¬”è®°&lt;/a>&lt;/li>
&lt;/ul>
&lt;h3 id="æ‰§è¡Œç®—æœ¯è¿ç®—">æ‰§è¡Œç®—æœ¯è¿ç®—&lt;/h3>
&lt;pre>&lt;code>val=`expr $a + $b`
&lt;/code>&lt;/pre>
&lt;h3 id="è¿ç®—ç¬¦">è¿ç®—ç¬¦&lt;/h3>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>ç¬¦å·&lt;/th>
&lt;th>è¯´æ˜&lt;/th>
&lt;th>ç¤ºä¾‹&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>!&lt;/td>
&lt;td>éè¿ç®—&lt;/td>
&lt;td>[ ! false ]&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>-o&lt;/td>
&lt;td>æˆ–è¿ç®—&lt;/td>
&lt;td>[ $a -lt 20 -o $b -gt 20 ]&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>-a&lt;/td>
&lt;td>ä¸è¿ç®—&lt;/td>
&lt;td>[ $a -lt 20 -a $b -gt 20 ]&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>=&lt;/td>
&lt;td>ç›¸ç­‰æ£€æµ‹&lt;/td>
&lt;td>[ $a = $b ]&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>!=&lt;/td>
&lt;td>ä¸ç›¸ç­‰æ£€æµ‹&lt;/td>
&lt;td>[ $a != $b ]&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>-z&lt;/td>
&lt;td>å­—ç¬¦ä¸²é•¿åº¦æ˜¯å¦ä¸º 0ï¼Œä¸º 0 åˆ™è¿”å› true&lt;/td>
&lt;td>[ -z $a ]&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>-n&lt;/td>
&lt;td>å­—ç¬¦ä¸²é•¿åº¦ä¸ä¸º 0ï¼Œ ä¸ä¸º 0 è¿”å› true&lt;/td>
&lt;td>[ -n $a ]&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>str&lt;/td>
&lt;td>æ£€æµ‹å­—ç¬¦ä¸²æ˜¯å¦ä¸ºç©ºï¼Œä¸ä¸ºç©ºè¿”å› true&lt;/td>
&lt;td>[ $a ]&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>-b&lt;/td>
&lt;td>æ£€æµ‹æ–‡ä»¶æ˜¯å¦æ˜¯å—è®¾å¤‡æ–‡ä»¶&lt;/td>
&lt;td>[ -b $file ]&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>-c&lt;/td>
&lt;td>æ£€æµ‹æ–‡ä»¶æ˜¯å¦æ˜¯å­—ç¬¦è®¾å¤‡&lt;/td>
&lt;td>..&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>-d&lt;/td>
&lt;td>æ£€æµ‹æ–‡ä»¶æ˜¯å¦ä¸ºç›®å½•&lt;/td>
&lt;td>[ -d $file ]&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>-f&lt;/td>
&lt;td>æ£€æµ‹æ–‡ä»¶æ˜¯å¦ä¸ºæ™®é€šæ–‡ä»¶&lt;/td>
&lt;td>[ -f $file ]&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>-r&lt;/td>
&lt;td>æ£€æµ‹æ–‡ä»¶æ˜¯å¦å¯è¯»&lt;/td>
&lt;td>..&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>-w&lt;/td>
&lt;td>æ£€æµ‹æ–‡ä»¶æ˜¯å¦å¯å†™&lt;/td>
&lt;td>..&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>-x&lt;/td>
&lt;td>æ£€æµ‹æ–‡ä»¶æ˜¯å¦å¯æ‰§è¡Œ&lt;/td>
&lt;td>..&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>-s&lt;/td>
&lt;td>æ£€æµ‹æ–‡ä»¶æ˜¯å¦ä¸ºç©º&lt;/td>
&lt;td>..&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>-e&lt;/td>
&lt;td>æ£€æµ‹æ–‡ä»¶æ˜¯å¦å­˜åœ¨&lt;/td>
&lt;td>..&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h3 id="ç‰¹æ®Šå˜é‡">ç‰¹æ®Šå˜é‡&lt;/h3>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>å˜é‡&lt;/th>
&lt;th>å«ä¹‰&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>$0&lt;/td>
&lt;td>å½“å‰è„šæœ¬çš„æ–‡ä»¶å&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>$n&lt;/td>
&lt;td>ä¼ é€’ç»™è„šæœ¬æˆ–å‡½æ•°çš„å‚æ•°ã€‚n æ˜¯ä¸€ä¸ªæ•°å­—ï¼Œè¡¨ç¤ºç¬¬å‡ ä¸ªå‚æ•°&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>$#&lt;/td>
&lt;td>ä¼ é€’ç»™è„šæœ¬æˆ–å‡½æ•°çš„å‚æ•°ä¸ªæ•°&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>$*&lt;/td>
&lt;td>ä¼ é€’ç»™è„šæœ¬æˆ–å‡½æ•°çš„æ‰€æœ‰å‚æ•°ï¼Œæ‰€æœ‰å‚æ•°è¢«å½“åšä¸€ä¸ªè¯ï¼Œä¾‹å¦‚ &amp;ldquo;1 2 3&amp;rdquo;&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>$@&lt;/td>
&lt;td>ä¼ é€’ç»™è„šæœ¬æˆ–å‡½æ•°çš„æ‰€æœ‰å‚æ•°ï¼Œæ¯ä¸ªå‚æ•°å½“åšä¸€ä¸ªè¯ï¼Œç”¨åŒå¼•å·åŒ…å«ï¼Œä¾‹å¦‚&amp;quot;1&amp;quot; &amp;ldquo;2&amp;rdquo; &amp;ldquo;3&amp;rdquo;&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>$?&lt;/td>
&lt;td>ä¸Šä¸ªå‘½ä»¤çš„é€€å‡ºçŠ¶æ€ï¼Œæˆ–å‡½æ•°çš„è¿”å›å€¼&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>$$&lt;/td>
&lt;td>å½“å‰ Shell è¿›ç¨‹ IDã€‚å¯¹äº Shell è„šæœ¬ï¼Œå°±æ˜¯è¿™äº›è„šæœ¬æ‰€åœ¨çš„è¿›ç¨‹ ID&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h3 id="posix-ç¨‹åºé€€å‡ºçŠ¶æ€">POSIX ç¨‹åºé€€å‡ºçŠ¶æ€&lt;/h3>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>çŠ¶æ€ç &lt;/th>
&lt;th>å«ä¹‰&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>0&lt;/td>
&lt;td>å‘½ä»¤æˆåŠŸé€€å‡º&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&amp;gt; 0&lt;/td>
&lt;td>åœ¨é‡å®šå‘æˆ–è€…å•è¯å±•å¼€æœŸé—´(~ã€å˜é‡ã€å‘½ä»¤ã€ç®—æœ¯å±•å¼€ä»¥åŠå•è¯åˆ‡å‰²)å¤±è´¥&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>1 - 125&lt;/td>
&lt;td>å‘½ä»¤ä¸æˆåŠŸé€€å‡ºã€‚ç‰¹å®šçš„é€€å‡ºå€¼çš„å«ä¹‰ï¼Œæœ‰å„ä¸ªå‘½ä»¤è‡ªè¡Œå®šä¹‰&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>126&lt;/td>
&lt;td>å‘½ä»¤æ‰¾åˆ°äº†ï¼Œä½†æ˜¯æ–‡ä»¶æ— æ³•æ‰§è¡Œ&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>127&lt;/td>
&lt;td>å‘½ä»¤æ²¡æœ‰æ‰¾åˆ°&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&amp;gt; 128&lt;/td>
&lt;td>å‘½ä»¤å› æ”¶åˆ°ä¿¡å·è€Œæ­»äº¡&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h3 id="è¾“å…¥è¾“å‡ºé‡å®šå‘">è¾“å…¥è¾“å‡ºé‡å®šå‘&lt;/h3>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>å‘½ä»¤&lt;/th>
&lt;th>è¯´æ˜&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>command &amp;gt; file&lt;/td>
&lt;td>å°†è¾“å‡ºé‡å®šå‘åˆ° fileã€‚&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>command &amp;gt; file&lt;/td>
&lt;td>å°†è¾“å‡ºä»¥è¿½åŠ çš„æ–¹å¼é‡å®šå‘åˆ° fileã€‚&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>n &amp;gt; file&lt;/td>
&lt;td>å°†æ–‡ä»¶æè¿°ç¬¦ä¸º n çš„æ–‡ä»¶é‡å®šå‘åˆ° fileã€‚&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>n &amp;raquo; file&lt;/td>
&lt;td>å°†æ–‡ä»¶æè¿°ç¬¦ä¸º n çš„æ–‡ä»¶ä»¥è¿½åŠ çš„æ–¹å¼é‡å®šå‘åˆ° fileã€‚&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>n &amp;gt;&amp;amp; m&lt;/td>
&lt;td>å°†è¾“å‡ºæ–‡ä»¶ m å’Œ n åˆå¹¶ã€‚&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>n &amp;lt;&amp;amp; m&lt;/td>
&lt;td>å°†è¾“å…¥æ–‡ä»¶ m å’Œ n åˆå¹¶ã€‚&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&amp;laquo; tag&lt;/td>
&lt;td>å°†å¼€å§‹æ ‡è®° tag å’Œç»“æŸæ ‡è®° tag ä¹‹é—´çš„å†…å®¹ä½œä¸ºè¾“å…¥ã€‚&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h3 id="æ–‡ä»¶åŒ…å«">æ–‡ä»¶åŒ…å«&lt;/h3>
&lt;p>ä½¿ç”¨&lt;code>.&lt;/code>æˆ–è€…&lt;code>source&lt;/code>åŒ…å«æ–‡ä»¶&lt;/p></description></item><item><title>Excessive Errors from `sentry.lang.javascript.processor: SoftTimeLimitExceeded()`</title><link>https://linzeyan.github.io/posts/2019/20190725-getsentry-sentry-issues-4386/</link><pubDate>Thu, 25 Jul 2019 14:25:56 +0800</pubDate><guid>https://linzeyan.github.io/posts/2019/20190725-getsentry-sentry-issues-4386/</guid><description>&lt;ul>
&lt;li>&lt;a href="https://github.com/getsentry/sentry/issues/4386" target="_blank" rel="noopener">Excessive Errors from &lt;code>sentry.lang.javascript.processor: SoftTimeLimitExceeded()&lt;/code>&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://forum.sentry.io/t/counters-0-queue-is-rising-continuously/5655/6" target="_blank" rel="noopener">Counters-0 queue is rising continuously&lt;/a>&lt;/li>
&lt;/ul>
&lt;h4 id="excessive-errors-from-sentrylangjavascriptprocessor-softtimelimitexceeded">Excessive Errors from &lt;code>sentry.lang.javascript.processor: SoftTimeLimitExceeded()&lt;/code>&lt;/h4>
&lt;p>mattrobenolt:&lt;/p>
&lt;p>Was just going to propose this. :) Unfortunately, this is just how this feature works. If it&amp;rsquo;s not useful and is just wasting resources, it&amp;rsquo;s easy to disable globally by setting &lt;code>SENTRY_SCRAPE_JAVASCRIPT_CONTEXT = False&lt;/code> in your &lt;code>sentry.conf.py&lt;/code> or per project in the UI.&lt;/p>
&lt;p>Other than that, there&amp;rsquo;s not much else we can do here since the feature is effectively working as intended.&lt;/p></description></item><item><title>Python Telegram Bot</title><link>https://linzeyan.github.io/posts/2019/20190711-python-telegram-bot/</link><pubDate>Thu, 11 Jul 2019 14:03:25 +0800</pubDate><guid>https://linzeyan.github.io/posts/2019/20190711-python-telegram-bot/</guid><description>&lt;ul>
&lt;li>&lt;a href="https://zaoldyeck.medium.com/%E6%89%8B%E6%8A%8A%E6%89%8B%E6%95%99%E4%BD%A0%E6%80%8E%E9%BA%BC%E6%89%93%E9%80%A0-telegram-bot-a7b539c3402a" target="_blank" rel="noopener">ï¼ˆä¸€ï¼‰ä¸€æ­¥æ­¥æ‰“é€  Telegram Bot&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://zaoldyeck.medium.com/%E5%88%A9%E7%94%A8-olami-open-api-%E7%82%BA-chatbot-%E5%A2%9E%E5%8A%A0-nlp-%E5%8A%9F%E8%83%BD-e6b37940913d" target="_blank" rel="noopener">ï¼ˆäºŒï¼‰ç‚º Chatbot å¢åŠ  NLP åŠŸèƒ½&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://zaoldyeck.medium.com/add-custom-skill-into-chatbot-cef9bfeeef52" target="_blank" rel="noopener">ï¼ˆä¸‰ï¼‰ç‚º Chatbot æ·»åŠ æ–°æŠ€èƒ½&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://hackmd.io/@truckski/HkgaMUc24" target="_blank" rel="noopener">Python Telegram Bot æ•™å­¸&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://kaive.me/2018/07/15/Python-telegram-bot/" target="_blank" rel="noopener">ç”¨ Python å†™ä¸€ä¸ªç®€å•çš„ Telegram Bot&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://github.com/python-telegram-bot/python-telegram-bot/wiki/Code-snippets" target="_blank" rel="noopener">https://github.com/python-telegram-bot/python-telegram-bot/wiki/Code-snippets&lt;/a>&lt;/li>
&lt;/ul></description></item><item><title>linuxç£ç¢Ÿç©ºé–“æ²’é‡‹æ”¾çš„è§£æ±ºæ–¹æ³•</title><link>https://linzeyan.github.io/posts/2019/20190710-linux-command-line-du-dh-lsof/</link><pubDate>Wed, 10 Jul 2019 09:57:33 +0800</pubDate><guid>https://linzeyan.github.io/posts/2019/20190710-linux-command-line-du-dh-lsof/</guid><description>&lt;ul>
&lt;li>&lt;a href="https://www.itread01.com/content/1542767890.html" target="_blank" rel="noopener">linux ç£ç¢Ÿç©ºé–“æ²’é‡‹æ”¾çš„è§£æ±ºæ–¹æ³•&lt;/a>&lt;/li>
&lt;/ul>
&lt;h5 id="ç”¨-df--ah-å‘½ä»¤-du--h---max-depth1">ç”¨ &lt;code>df -ah&lt;/code> å‘½ä»¤ &lt;code>du -h --max-depth=1&lt;/code>&lt;/h5>
&lt;p>&lt;code>du&lt;/code> ä¹‹å’Œé é å°æ–¼ &lt;code>df&lt;/code> å¾—åˆ°çš„ç¸½é‡&lt;/p>
&lt;p>ç¨‹åºä½¿ç”¨çš„æª”æ¡ˆè³‡æºè¢«åˆªé™¤å¾Œï¼Œç¨‹åºé‚„æ´»è‘—ï¼Œå°è‡´æª”æ¡ˆæœªè¢«çœŸæ­£åˆªé™¤ï¼Œç„¡æ³•é‡‹æ”¾ç£ç¢Ÿç©ºé–“ï¼Œå»ä¸¦ä¸èƒ½è¢«çµ±è¨ˆåˆ°ã€‚&lt;/p>
&lt;p>&lt;code>lsof |grep delete&lt;/code>&lt;/p></description></item><item><title>Sentry æºç å¼€å‘ç¬”è®°</title><link>https://linzeyan.github.io/posts/2019/20190703-python-sentry-develop-notes-and-uwsgi-log-format/</link><pubDate>Wed, 03 Jul 2019 11:53:15 +0800</pubDate><guid>https://linzeyan.github.io/posts/2019/20190703-python-sentry-develop-notes-and-uwsgi-log-format/</guid><description>&lt;ul>
&lt;li>&lt;a href="https://chroming.gitlab.io/2018/09/26/edit_sentry_source_code/" target="_blank" rel="noopener">Sentry æºç å¼€å‘ç¬”è®°&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://uwsgi-docs.readthedocs.io/en/latest/LogFormat.html" target="_blank" rel="noopener">Formatting uWSGI requests logs&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://www.postgresql.org/docs/9.3/libpq-pgpass.html" target="_blank" rel="noopener">PostgreSQL: Documentation: 9.3: The Password File&lt;/a>&lt;/li>
&lt;/ul></description></item><item><title>openresty+redisæ‹¦æˆªé«˜é¢‘è®¿é—®IP</title><link>https://linzeyan.github.io/posts/2019/20190627-openrestyredis/</link><pubDate>Thu, 27 Jun 2019 11:18:46 +0800</pubDate><guid>https://linzeyan.github.io/posts/2019/20190627-openrestyredis/</guid><description>&lt;ul>
&lt;li>&lt;a href="https://www.centos.bz/2018/11/openrestyredis%E6%8B%A6%E6%88%AA%E9%AB%98%E9%A2%91%E8%AE%BF%E9%97%AEip/" target="_blank" rel="noopener">openresty+redis æ‹¦æˆªé«˜é¢‘è®¿é—® IP&lt;/a>&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-nginx" data-lang="nginx">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">init_by_lua_block&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">redis&lt;/span> = &lt;span style="color:#e6db74">require&lt;/span> &lt;span style="color:#e6db74">&amp;#34;redis&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">client&lt;/span> = &lt;span style="color:#e6db74">redis.connect(&amp;#39;127.0.0.1&amp;#39;,&lt;/span> &lt;span style="color:#ae81ff">6379&lt;/span>&lt;span style="color:#e6db74">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74">server&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">listen&lt;/span> &lt;span style="color:#ae81ff">8080&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">location&lt;/span> &lt;span style="color:#e6db74">/&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">access_by_lua_file&lt;/span> &lt;span style="color:#e6db74">/usr/local/nginx/conf/lua/block.lua&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">proxy_pass&lt;/span> &lt;span style="color:#e6db74">http://192.168.1.102:8000&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-lua" data-lang="lua">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">-- Redis-based IP rate limiting / blocking for OpenResty (ngx_lua)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">-- NOTE:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">-- This script assumes a global `client` variable is used/stored.&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">-- Make sure `redis` module is available and `client` is initialized somewhere.&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">local&lt;/span> &lt;span style="color:#66d9ef">function&lt;/span> &lt;span style="color:#a6e22e">isConnected&lt;/span>()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> client:ping()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">end&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">local&lt;/span> &lt;span style="color:#66d9ef">function&lt;/span> &lt;span style="color:#a6e22e">createRedisConnection&lt;/span>()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> redis.connect(&lt;span style="color:#e6db74">&amp;#34;127.0.0.1&amp;#34;&lt;/span>, &lt;span style="color:#ae81ff">6379&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">end&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">-- å¦‚æœå‘ç”Ÿ redis è¿æ¥å¤±è´¥ï¼Œå°†åœæ­¢æ‹¦æˆªï¼ˆç›´æ¥æ”¾è¡Œï¼‰&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">if&lt;/span> pcall(isConnected) &lt;span style="color:#66d9ef">then&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">-- already connected (or ping succeeded)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">else&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">-- not connected; try reconnect&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> pcall(createRedisConnection) &lt;span style="color:#66d9ef">then&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">-- æ–­å¼€é‡è¿ï¼šä¼šå¯¼è‡´æ¯æ¬¡è®¿é—®éƒ½éœ€è¦é‡è¿ redis&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">-- è®¿é—®é‡å¤§æ—¶å»ºè®®ï¼šå…³é—­é‡è¿é€»è¾‘ï¼ˆpcall ä¸æ‰§è¡Œï¼‰ï¼Œç›´æ¥ ngx.exit æ”¾è¡Œ/ç»ˆæ­¢&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> client &lt;span style="color:#f92672">=&lt;/span> createRedisConnection()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">else&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ngx.exit(ngx.OK)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">end&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">end&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">local&lt;/span> ttl &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">60&lt;/span> &lt;span style="color:#75715e">-- ç›‘æµ‹å‘¨æœŸï¼ˆç§’ï¼‰&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">local&lt;/span> bktimes &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">30&lt;/span> &lt;span style="color:#75715e">-- åœ¨ç›‘æµ‹å‘¨æœŸå†…è¾¾åˆ°è§¦å‘æ‹¦æˆªçš„è®¿é—®é‡&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">local&lt;/span> block_ttl &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">600&lt;/span> &lt;span style="color:#75715e">-- è§¦å‘æ‹¦æˆªåæ‹¦æˆªæ—¶é—´ï¼ˆç§’ï¼‰&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">local&lt;/span> ip &lt;span style="color:#f92672">=&lt;/span> ngx.var.remote_addr
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">local&lt;/span> ipvtimes &lt;span style="color:#f92672">=&lt;/span> client:get(ip)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">if&lt;/span> ipvtimes &lt;span style="color:#66d9ef">then&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> ipvtimes &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#e6db74">&amp;#34;-1&amp;#34;&lt;/span> &lt;span style="color:#66d9ef">then&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">-- blocked&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> ngx.exit(&lt;span style="color:#ae81ff">403&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">else&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">local&lt;/span> last_ttl &lt;span style="color:#f92672">=&lt;/span> client:ttl(ip)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">-- ngx.say(&amp;#34;key exist.ttl is &amp;#34;, last_ttl)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> last_ttl &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span> &lt;span style="color:#66d9ef">then&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> client:set(ip, &lt;span style="color:#ae81ff">0&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> client:expire(ip, ttl)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">-- ngx.say(&amp;#34;ttl &amp;amp; vtimes recount&amp;#34;)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> ngx.exit(ngx.OK)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">end&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">local&lt;/span> vtimes &lt;span style="color:#f92672">=&lt;/span> tonumber(client:get(ip)) &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> vtimes &lt;span style="color:#f92672">&amp;lt;&lt;/span> bktimes &lt;span style="color:#66d9ef">then&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> client:set(ip, vtimes)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> client:expire(ip, last_ttl)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">-- ngx.say(ip, &amp;#34; view &amp;#34;, vtimes, &amp;#34; times&amp;#34;)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> ngx.exit(ngx.OK)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">else&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">-- ngx.say(ip, &amp;#34; will be block next time.&amp;#34;)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> client:set(ip, &lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> client:expire(ip, block_ttl)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> ngx.exit(ngx.OK)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">end&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">end&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">else&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">-- key does not exist&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> client:set(ip, &lt;span style="color:#ae81ff">1&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">-- ngx.say(ip, &amp;#34; view 1 times&amp;#34;)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> client:expire(ip, ttl)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> ngx.exit(ngx.OK)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">end&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>[Terraform] å…¥é–€å­¸ç¿’ç­†è¨˜</title><link>https://linzeyan.github.io/posts/2019/20190626-terraform-getting-started/</link><pubDate>Wed, 26 Jun 2019 17:22:52 +0800</pubDate><guid>https://linzeyan.github.io/posts/2019/20190626-terraform-getting-started/</guid><description>&lt;ul>
&lt;li>&lt;a href="https://godleon.github.io/blog/DevOps/terraform-getting-started/" target="_blank" rel="noopener">[Terraform] å…¥é–€å­¸ç¿’ç­†è¨˜&lt;/a>&lt;/li>
&lt;/ul></description></item><item><title>è¨­å®š Haproxy ä»¥é˜²æ­¢ DDOS æ”»æ“Š</title><link>https://linzeyan.github.io/posts/2019/20190617-haproxy-ddos/</link><pubDate>Mon, 17 Jun 2019 11:07:13 +0800</pubDate><guid>https://linzeyan.github.io/posts/2019/20190617-haproxy-ddos/</guid><description>&lt;ul>
&lt;li>&lt;a href="https://blog.maxkit.com.tw/2016/05/haproxy-ddos.html" target="_blank" rel="noopener">è¨­å®š Haproxy ä»¥é˜²æ­¢ DDOS æ”»æ“Š&lt;/a>&lt;/li>
&lt;/ul>
&lt;h3 id="tcp-syn-flood-attacks">TCP syn flood attacks&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>vi /etc/sysctl.conf
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># Protection from SYN flood&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>net.ipv4.tcp_syncookies &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>net.ipv4.conf.all.rp_filter &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>net.ipv4.tcp_max_syn_backlog &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">1024&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="slowloris-like-attacks">Slowloris like attacks&lt;/h3>
&lt;pre tabindex="0">&lt;code>defaults
option http-server-close
timeout http-request 5s
timeout connect 5s
timeout client 30s
timeout server 10s
timeout tunnel 1h
&lt;/code>&lt;/pre>&lt;h3 id="é™åˆ¶æ¯ä¸€å€‹-user-çš„é€£ç·šæ•¸é‡">é™åˆ¶æ¯ä¸€å€‹ user çš„é€£ç·šæ•¸é‡&lt;/h3>
&lt;p>æ™®é€šç”¨æˆ¶ç€è¦½ç¶²ç«™çš„ç¶²é ï¼Œæˆ–æ˜¯å¾ç¶²ç«™ä¸‹è¼‰æ±è¥¿æ™‚ï¼Œç€è¦½å™¨ä¸€èˆ¬æœƒå»ºç«‹ 5-7 å€‹ TCP éˆæ¥ã€‚ç•¶ä¸€å€‹æƒ¡æ„ client æ‰“é–‹äº†å¤§é‡ TCP é€£ç·šæ™‚ï¼Œè€—è²»å¤§é‡è³‡æºï¼Œå› æ­¤æˆ‘å€‘å¿…é ˆè¦é™åˆ¶åŒä¸€å€‹ç”¨æˆ¶çš„é€£ç·šæ•¸é‡ã€‚&lt;/p>
&lt;p>ä½†å¦‚æœæœ‰å¾ˆå¤šä½¿ç”¨è€…ï¼Œæ˜¯å¾æŸä¸€å€‹ç§æœ‰ç¶²æ®µï¼Œé€é NAT çš„æ–¹å¼é€£ç·šåˆ° Server æ™‚ï¼Œä¸”å¯¦éš›ä¸Šæˆ‘å€‘ä¹Ÿä¸çŸ¥é“ï¼Œåˆ°åº•å“ªä¸€å€‹æœƒæ˜¯ NAT çš„è½‰å€å¾Œçš„ IPï¼Œä¸çŸ¥é“è©²å°‡å“ªå€‹ IP è¨­å®šç‚ºç™½åå–®ï¼Œé€™æ¨£çš„é™åˆ¶å°±æœƒé€ æˆå•é¡Œï¼Œå› æ­¤æˆ‘å€‘èªç‚ºå¯¦éš›çš„ç’°å¢ƒï¼Œé€™æ¨£çš„è¨­å®šæ‡‰è©²è¦ä¿ç•™ä¸è™•ç†ã€‚&lt;/p>
&lt;p>ä»¥ä¸‹æ˜¯ä¸€å€‹è¨­å®šçš„ç¯„ä¾‹ï¼Œæœ€é‡è¦çš„åœ°æ–¹æ˜¯åœ¨ frontend ft_web å€å¡Šçš„è¨­å®šã€‚&lt;/p>
&lt;pre tabindex="0">&lt;code>global
stats socket ./haproxy.stats level admin
defaults
option http-server-close
mode http
timeout http-request 5s
timeout connect 5s
timeout server 10s
timeout client 30s
listen stats
bind 0.0.0.0:8880
stats enable
stats hide-version
stats uri /
stats realm HAProxy Statistics
stats auth admin:admin
frontend ft_web
bind 0.0.0.0:8080
# Table definition
stick-table type ip size 100k expire 30s store conn_cur
# Allow clean known IPs to bypass the filter
tcp-request connection accept if { src -f /etc/haproxy/whitelist.lst }
# Shut the new connection as long as the client has already 10 opened
tcp-request connection reject if { src_conn_cur ge 10 }
tcp-request connection track-sc1 src
# Split static and dynamic traffic since these requests have different impacts on the servers
use_backend bk_web_static if { path_end .jpg .png .gif .css .js }
default_backend bk_web
# Dynamic part of the application
backend bk_web
balance roundrobin
cookie MYSRV insert indirect nocache
server srv1 192.168.1.2:80 check cookie srv1 maxconn 100
server srv2 192.168.1.3:80 check cookie srv2 maxconn 100
# Static objects
backend bk_web_static
balance roundrobin
server srv1 192.168.1.2:80 check maxconn 1000
server srv2 192.168.1.3:80 check maxconn 1000
&lt;/code>&lt;/pre>&lt;h3 id="é™åˆ¶æ¯å€‹-user-ç”¢ç”Ÿæ–°é€£ç·šçš„é€Ÿç‡-limiting-the-connection-rate-per-user">é™åˆ¶æ¯å€‹ user ç”¢ç”Ÿæ–°é€£ç·šçš„é€Ÿç‡ Limiting the connection rate per user&lt;/h3>
&lt;p>æƒ¡æ„çš„ä½¿ç”¨è€…æœƒåœ¨çŸ­æ™‚é–“å…§å»ºç«‹å¾ˆå¤šé€£ç·šï¼Œä½†å¦‚æœç”¢ç”Ÿæ–°é€£ç·šçš„é€Ÿåº¦å¤ªé«˜ï¼Œå°±æœƒæ¶ˆè€—æ‰éå¤šçš„è³‡æºæœå‹™ä¸€å€‹ä½¿ç”¨è€…ã€‚&lt;/p></description></item><item><title>ç™½è¯ Kubernetes Runtime</title><link>https://linzeyan.github.io/posts/2019/20190613-k8s-runtime/</link><pubDate>Thu, 13 Jun 2019 11:28:26 +0800</pubDate><guid>https://linzeyan.github.io/posts/2019/20190613-k8s-runtime/</guid><description>&lt;ul>
&lt;li>&lt;a href="https://mp.weixin.qq.com/s?__biz=Mzg5Mjc3MjIyMA==&amp;amp;mid=2247543594&amp;amp;idx=1&amp;amp;sn=9083cff79ca7f5fb9d6fee08d1144989&amp;amp;source=41&amp;amp;poc_token=HL8MZmmjq-HF5O8fHC711sGwSQ1O9OuO5hGLL_px" target="_blank" rel="noopener">ç™½è¯ Kubernetes Runtime&lt;/a>&lt;/li>
&lt;/ul></description></item><item><title>Nginxè¯·æ±‚å¤„ç†æµç¨‹ä½ äº†è§£å—ï¼Ÿ</title><link>https://linzeyan.github.io/posts/2019/20190307-nginx/</link><pubDate>Thu, 07 Mar 2019 14:05:55 +0800</pubDate><guid>https://linzeyan.github.io/posts/2019/20190307-nginx/</guid><description>&lt;ul>
&lt;li>&lt;a href="https://mp.weixin.qq.com/s/otQIhuLABU3omOLtRfJnZQ" target="_blank" rel="noopener">Nginx è¯·æ±‚å¤„ç†æµç¨‹ä½ äº†è§£å—ï¼Ÿ&lt;/a>&lt;/li>
&lt;/ul>
&lt;h3 id="11-ä¸ªå¤„ç†é˜¶æ®µ">11 ä¸ªå¤„ç†é˜¶æ®µ&lt;/h3>
&lt;p>1ï¼‰NGX_HTTP_POST_READ_PHASEï¼š&lt;/p>
&lt;p>æ¥æ”¶åˆ°å®Œæ•´çš„ HTTP å¤´éƒ¨åå¤„ç†çš„é˜¶æ®µï¼Œå®ƒä½äº uri é‡å†™ä¹‹å‰ï¼Œå®é™…ä¸Šå¾ˆå°‘æœ‰æ¨¡å—ä¼šæ³¨å†Œåœ¨è¯¥é˜¶æ®µï¼Œé»˜è®¤çš„æƒ…å†µä¸‹ï¼Œè¯¥é˜¶æ®µè¢«è·³è¿‡ã€‚&lt;/p>
&lt;p>2ï¼‰NGX_HTTP_SERVER_REWRITE_PHASEï¼š&lt;/p>
&lt;p>URI ä¸ location åŒ¹é…å‰ï¼Œä¿®æ”¹ URI çš„é˜¶æ®µï¼Œç”¨äºé‡å®šå‘ï¼Œä¹Ÿå°±æ˜¯è¯¥é˜¶æ®µæ‰§è¡Œå¤„äº server å—å†…ï¼Œlocation å—å¤–çš„é‡å†™æŒ‡ä»¤ï¼Œåœ¨è¯»å–è¯·æ±‚å¤´çš„è¿‡ç¨‹ä¸­ nginx ä¼šæ ¹æ® host åŠç«¯å£æ‰¾åˆ°å¯¹åº”çš„è™šæ‹Ÿä¸»æœºé…ç½®ã€‚&lt;/p>
&lt;p>3ï¼‰NGX_HTTP_FIND_CONFIG_PHASEï¼š&lt;/p>
&lt;p>æ ¹æ® URI å¯»æ‰¾åŒ¹é…çš„ location å—é…ç½®é¡¹é˜¶æ®µï¼Œè¯¥é˜¶æ®µä½¿ç”¨é‡å†™ä¹‹åçš„ uri æ¥æŸ¥æ‰¾å¯¹åº”çš„ locationï¼Œå€¼å¾—æ³¨æ„çš„æ˜¯è¯¥é˜¶æ®µå¯èƒ½ä¼šè¢«æ‰§è¡Œå¤šæ¬¡ï¼Œå› ä¸ºä¹Ÿå¯èƒ½æœ‰ location çº§åˆ«çš„é‡å†™æŒ‡ä»¤ã€‚&lt;/p>
&lt;p>4ï¼‰NGX_HTTP_REWRITE_PHASEï¼š&lt;/p>
&lt;p>ä¸Šä¸€é˜¶æ®µæ‰¾åˆ° location å—åå†ä¿®æ”¹ URIï¼Œlocation çº§åˆ«çš„ uri é‡å†™é˜¶æ®µï¼Œè¯¥é˜¶æ®µæ‰§è¡Œ location åŸºæœ¬çš„é‡å†™æŒ‡ä»¤ï¼Œä¹Ÿå¯èƒ½ä¼šè¢«æ‰§è¡Œå¤šæ¬¡ã€‚&lt;/p>
&lt;p>5ï¼‰NGX_HTTP_POST_REWRITE_PHASEï¼š&lt;/p>
&lt;p>é˜²æ­¢é‡å†™ URL åå¯¼è‡´çš„æ­»å¾ªç¯ï¼Œlocation çº§åˆ«é‡å†™çš„åä¸€é˜¶æ®µï¼Œç”¨æ¥æ£€æŸ¥ä¸Šé˜¶æ®µæ˜¯å¦æœ‰ uri é‡å†™ï¼Œå¹¶æ ¹æ®ç»“æœè·³è½¬åˆ°åˆé€‚çš„é˜¶æ®µã€‚&lt;/p>
&lt;p>6ï¼‰NGX_HTTP_PREACCESS_PHASEï¼š&lt;/p>
&lt;p>ä¸‹ä¸€é˜¶æ®µä¹‹å‰çš„å‡†å¤‡ï¼Œè®¿é—®æƒé™æ§åˆ¶çš„å‰ä¸€é˜¶æ®µï¼Œè¯¥é˜¶æ®µåœ¨æƒé™æ§åˆ¶é˜¶æ®µä¹‹å‰ï¼Œä¸€èˆ¬ä¹Ÿç”¨äºè®¿é—®æ§åˆ¶ï¼Œæ¯”å¦‚é™åˆ¶è®¿é—®é¢‘ç‡ï¼Œé“¾æ¥æ•°ç­‰ã€‚&lt;/p>
&lt;p>7ï¼‰NGX_HTTP_ACCESS_PHASEï¼š&lt;/p>
&lt;p>è®© HTTP æ¨¡å—åˆ¤æ–­æ˜¯å¦å…è®¸è¿™ä¸ªè¯·æ±‚è¿›å…¥ Nginx æœåŠ¡å™¨ï¼Œè®¿é—®æƒé™æ§åˆ¶é˜¶æ®µï¼Œæ¯”å¦‚åŸºäº ip é»‘ç™½åå•çš„æƒé™æ§åˆ¶ï¼ŒåŸºäºç”¨æˆ·åå¯†ç çš„æƒé™æ§åˆ¶ç­‰ã€‚&lt;/p>
&lt;p>8ï¼‰NGX_HTTP_POST_ACCESS_PHASEï¼š&lt;/p>
&lt;p>è®¿é—®æƒé™æ§åˆ¶çš„åä¸€é˜¶æ®µï¼Œè¯¥é˜¶æ®µæ ¹æ®æƒé™æ§åˆ¶é˜¶æ®µçš„æ‰§è¡Œç»“æœè¿›è¡Œç›¸åº”å¤„ç†ï¼Œå‘ç”¨æˆ·å‘é€æ‹’ç»æœåŠ¡çš„é”™è¯¯ç ï¼Œç”¨æ¥å“åº”ä¸Šä¸€é˜¶æ®µçš„æ‹’ç»ã€‚&lt;/p>
&lt;p>9ï¼‰NGX_HTTP_TRY_FILES_PHASEï¼š&lt;/p>
&lt;p>ä¸ºè®¿é—®é™æ€æ–‡ä»¶èµ„æºè€Œè®¾ç½®ï¼Œtry_files æŒ‡ä»¤çš„å¤„ç†é˜¶æ®µï¼Œå¦‚æœæ²¡æœ‰é…ç½® try_files æŒ‡ä»¤ï¼Œåˆ™è¯¥é˜¶æ®µè¢«è·³è¿‡ã€‚&lt;/p>
&lt;p>10ï¼‰NGX_HTTP_CONTENT_PHASEï¼š&lt;/p></description></item></channel></rss>