# -*- mode: ruby -*-
# vi: set ft=ruby :
Vagrant.configure("2") do |config|
  config.vm.box = "centos/7"
  config.vm.hostname = "Centos1"
  config.vm.define vm_name = "centos1"
  config.vm.box_check_update = false
  config.vm.network "private_network", ip: "10.0.0.11"
  #config.vm.network "public_network" config.vm.network "public_network", ip: "{{ ansible_ssh_host }}"
  config.vm.network "public_network", bridge: "Intel(R) Ethernet Controller (2) I225-V"
  #config.vm.network :public_network, :bridge => "en0: Wi-Fi (Wireless)"
  # Share an additional folder to the guest VM. The first argument is # the path on the host to the actual folder. The second argument is # the path on the guest to mount the folder. And the optional third # argument is a set of non-required options.
  #config.vm.synced_folder "../data", "/vagrant_data"
  #config.vm.synced_folder "~/Github/scripts", "/vagrant", type: "rsync"
  config.vm.synced_folder "./", "/vagrant", type: "nfs", mount_options: ["dmode=775,fmode=664"]
  # Provider-specific configuration so you can fine-tune various # backing providers for Vagrant. These expose provider-specific options. # Example for VirtualBox:
  config.vm.provider "virtualbox" do |vb|
# # Display the VirtualBox GUI when booting the machine
# vb.gui = true
# # # Customize the amount of memory on the VM:
    vb.cpus = "2"
    vb.memory = "2048"
    vb.name = "centos1"
  end
  $script = <<-SCRIPT
    sed -i 's/SELINUX=enforcing/SELINUX=disabled/' /etc/selinux/config
    setenforce 0
    timedatectl set-timezone Asia/Taipei
    sudo yum install -y -q epel-release
    sudo yum install -y -q https://packages.endpoint.com/rhel/7/os/x86_64/endpoint-repo-1.7-1.x86_64.rpm
    sudo yum install -y -q \
      bind-utils \
      bridge-utils \
      chrony \
      curl \
      deltarpm \
      git \
      httping \
      htop \
      iftop \
      iotop \
      jq \
      lrzsz \
      lsof \
      net-tools \
      nmap \
      nmap-ncat \
      openssl \
      psmisc \
      python3 \
      sshpass \
      sysstat \
      tcpdump \
      tcping \
      tcptraceroute \
      telnet \
      tmux \
      tree \
      vim \
      wget \
      whois \
      wireshark \
      yum-utils
    sudo yum update -y -q
    curl -sSL https://get.docker.com/ | sudo bash
    sudo yum clean all
    sudo usermod -aG docker vagrant
    sudo systemctl enable --now docker
    python3 -m pip install -U pip
    pip3 install ansible
    pip3 install tldr
    pip3 install websocket-client
    sudo systemctl disable --now postfix
    systemctl disable --now rpcbind.socket
    # For VBoxLinuxAdditions.run
    yum install -y -q kernel-devel-$(uname -r) kernel-headers gcc elfutils-libelf-devel
    # Update sudo
    yum install -y -q https://www.sudo.ws/sudo/dist/packages/1.9.2/sudo-1.9.2-1.el7.x86_64.rpm
    # Modify prompt
    git clone https://github.com/linzeyan/git-radar /home/vagrant/.git-radar
    ln -s /home/vagrant/.git-radar/git-radar /usr/local/bin/
    # For git
    git clone https://github.com/linzeyan/terminal_config.git
    cp -rf terminal_config/centos/. /home/vagrant/
    cp -rf terminal_config/etc/sshd_config /etc/ssh/sshd_config
    rm -rf terminal_config
    echo 'export PS1="\\u(\W)\$(git-radar --bash) "' >> /home/vagrant/.bashrc
    echo "alias agent='eval \$(ssh-agent)'" >> /home/vagrant/.bashrc
    echo "alias oracle='ssh opc@129.146.172.132'" >> /home/vagrant/.bashrc
    chmod 700 /home/vagrant/.ssh
    chmod 600 /home/vagrant/.ssh/config
    curl https://github.com/linzeyan.keys >> /home/vagrant/.ssh/authorized_keys
    mkdir /git
    chown -R vagrant:vagrant /git
    # For Vim
    git clone https://github.com/VundleVim/Vundle.vim.git /home/vagrant/.vim/bundle/Vundle.vim
    chown -R vagrant:vagrant /home/vagrant
    sudo -u vagrant vim -c 'BundleInstall' -c 'q' -c 'q'
    chmod +x /etc/rc.d/rc.local
    #echo '192.168.0.0/16 via 192.168.1.1 dev eth2' >>/etc/sysconfig/network-scripts/route-eth2
    cat << eof >> /home/vagrant/.bashrc
    alias sshgcp="sshpass -p 'oNMdOwsUcNkhHNcSWR0!' ssh -p 8022 Ricky@34.92.125.176"
    alias ssh1b="sshpass -p 'DBRWa9BlZabLvJlD' ssh -p 10246 ricky@59.188.78.85"
    alias ssh2b="sshpass -p 'kj9*#4jh98djGS83' ssh -p 10246 Ricky_tw@69.172.89.200"
    alias ssh3b="sshpass -p 'N804kohIjO0LBFnT' ssh -p 10022 Ricky@185.109.18.71"
    alias ssh5b="sshpass -p '(*38UY0rFJ.*HYer' ssh -p 15589 Ricky_tw@173.248.244.3"
    eof
    reboot
    SCRIPT
  config.vm.provision "shell", inline: $script
end
