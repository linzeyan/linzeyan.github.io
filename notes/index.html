<!doctype html><html lang=en><head><title>Notes</title><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=X-UA-Compatible content="ie=edge"><link rel=stylesheet href=/application.780dc7a6fc8e42bf9fef490724bc6cbc57e759a0db2df60fcd517f9f667085ed.css integrity="sha256-eA3HpvyOQr+f70kHJLxsvFfnWaDbLfYPzVF/n2Zwhe0="><link rel=icon type=image/png href=/images/site/highlight.svg><link rel=alternate type=application/rss+xml href=https://linzeyan.github.io/notes/index.xml title=Ricky><meta property="og:title" content="Ricky"><meta property="og:type" content="website"><meta property="og:description" content="Ricky's Page."><meta property="og:image" content="/images/author/ava.jpg"><meta property="og:url" content="https://linzeyan.github.io/"><script defer src=https://static.cloudflareinsights.com/beacon.min.js data-cf-beacon='{"token": "27a0cd9f0e3b46909879cf99f7cc6878"}'></script><script integrity="sha256-DO4ugzEwhTW1Id1UIWn0gUJWaebCYOypeTit6LW4QB4=">let theme=localStorage.getItem("theme-scheme")||localStorage.getItem("darkmode:color-scheme")||"light";theme==="system"&&(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?theme="dark":theme="light"),document.documentElement.setAttribute("data-theme",theme)</script></head><body class="type-notes kind-section" data-bs-spy=scroll data-bs-target=#TableOfContents data-bs-offset=80><div class="container-fluid bg-secondary wrapper"><nav class="navbar navbar-expand-xl top-navbar shadow" id=top-navbar><div class=container><button class="navbar-toggler navbar-light" id=sidebar-toggler type=button>
<i data-feather=sidebar></i>
</button>
<a class=navbar-brand href=/><img src=/images/site/highlight.svg id=logo alt=Logo>
Ricky</a>
<button class="navbar-toggler navbar-light" id=navbar-toggler type=button data-bs-toggle=collapse data-bs-target=#top-nav-items aria-label=menu>
<i data-feather=menu></i></button><div class="collapse navbar-collapse dynamic-navbar" id=top-nav-items><ul class="nav navbar-nav ms-auto"><li class=nav-item><a class=nav-link href=/#home>Home</a></li><li class=nav-item><a class=nav-link href=/#about>About</a></li><li class="nav-item dropdown"><a class="nav-link dropdown-toggle" href=# id=navbarDropdown role=button data-bs-toggle=dropdown aria-haspopup=true aria-expanded=false>More</a><div class=dropdown-menu aria-labelledby=navbarDropdown><a class=dropdown-item href=/#skills>Skills</a>
<a class=dropdown-item href=/#experiences>Experiences</a>
<a class=dropdown-item href=/#education>Education</a>
<a class=dropdown-item href=/#projects>Projects</a></div></li><div id=top-navbar-divider></div><li class=nav-item><a class=nav-link id=blog-link href=/posts>Posts</a></li><li class=nav-item><a class=nav-link id=note-link href=/notes>Notes</a></li><li class=nav-item><a class=nav-link href=https://linzeyan.github.io/activities>Activities</a></li><li class=nav-item><a class=nav-link href=https://linzeyan.github.io/running>Running</a></li><li class="nav-item dropdown"><a class="nav-link dropdown-toggle" href=# id=languageSelector role=button data-bs-toggle=dropdown aria-haspopup=true aria-expanded=false><span class="fi fi-us"></span>
English</a><div class=dropdown-menu aria-labelledby=languageSelector><a class="dropdown-item nav-link languages-item" href=/notes><span class="fi fi-us"></span>
English
</a><a class="dropdown-item nav-link languages-item" href=/zh-tw/notes><span class="fi fi-tw"></span>
Chinese</a></div></li><li class="nav-item dropdown"><a class="nav-link dropdown-toggle" href=# id=themeSelector role=button data-bs-toggle=dropdown aria-haspopup=true aria-expanded=false><img id=navbar-theme-icon-svg class=theme-icon src=/icons/moon-svgrepo-com.svg width=20 alt="Dark Theme"></a><div id=themeMenu class="dropdown-menu dropdown-menu-icons-only" aria-labelledby=themeSelector><a class="dropdown-item nav-link" href=# data-scheme=light><img class=theme-icon src=/icons/sun-svgrepo-com.svg width=20 alt="Light Theme">
</a><a class="dropdown-item nav-link" href=# data-scheme=dark><img class=theme-icon src=/icons/moon-svgrepo-com.svg width=20 alt="Dark Theme">
</a><a class="dropdown-item nav-link" href=# data-scheme=system><img class=theme-icon src=/icons/computer-svgrepo-com.svg width=20 alt="System Theme"></a></div></li></ul></div></div><img src=/images/site/highlight.svg class=d-none id=main-logo alt=Logo>
<img src=/images/site/highlight.svg class=d-none id=inverted-logo alt="Inverted Logo"></nav><section class=sidebar-section id=sidebar-section><div class=sidebar-holder><div class=sidebar id=sidebar><form class=mx-auto method=get action=/search><input type=text name=keyword placeholder=Search data-search id=search-box></form><div class=sidebar-tree><ul class=tree id=tree><li id=list-heading><a href=/notes data-filter=all>Notes</a></li><div class=subtree><li><i data-feather=plus-circle></i><a class=list-link href=/notes/aws/> AWS</a><ul><li><a class=list-link href=/notes/aws/command/ title=command>command</a></li><li><a class=list-link href=/notes/aws/configure/ title=configure>configure</a></li><li><a class=list-link href=/notes/aws/terraform/ title=terraform>terraform</a></li></ul></li><li><i data-feather=plus-circle></i><a class=list-link href=/notes/bash/> Bash</a><ul><li><a class=list-link href=/notes/bash/ansible/ title=ansible>ansible</a></li><li><a class=list-link href=/notes/bash/common/ title=common>common</a></li><li><a class=list-link href=/notes/bash/docker/ title=docker>docker</a></li><li><a class=list-link href=/notes/bash/file/ title=file>file</a></li><li><a class=list-link href=/notes/bash/git/ title=git>git</a></li><li><a class=list-link href=/notes/bash/gitlab/ title=gitlab>gitlab</a></li><li><a class=list-link href=/notes/bash/gpg/ title=gpg>gpg</a></li><li><a class=list-link href=/notes/bash/k8s/ title=k8s>k8s</a></li><li><a class=list-link href=/notes/bash/network/ title=network>network</a></li><li><a class=list-link href=/notes/bash/pandoc/ title=pandoc>pandoc</a></li><li><a class=list-link href=/notes/bash/redis/ title=redis>redis</a></li><li><a class=list-link href=/notes/bash/ssh/ title=ssh>ssh</a></li><li><a class=list-link href=/notes/bash/telegram/ title=telegram>telegram</a></li></ul></li><li><i data-feather=plus-circle></i><a class=list-link href=/notes/docs/> Docs</a><ul><li><a class=list-link href=/notes/docs/cloudflare/ title=cloudflare>cloudflare</a></li><li><a class=list-link href=/notes/docs/diagrams/ title=diagrams>diagrams</a></li><li><a class=list-link href=/notes/docs/docker/ title=docker>docker</a></li><li><a class=list-link href=/notes/docs/gitlab/ title=gitlab>gitlab</a></li><li><a class=list-link href=/notes/docs/linux/ title=linux>linux</a></li><li><a class=list-link href=/notes/docs/mermaid/ title=mermaid>mermaid</a></li><li><a class=list-link href=/notes/docs/network/ title=network>network</a></li><li><a class=list-link href=/notes/docs/nginx/ title=nginx>nginx</a></li><li><a class=list-link href=/notes/docs/vagrant/ title=vagrant>vagrant</a></li><li><a class=list-link href=/notes/docs/zabbix/ title=zabbix>zabbix</a></li></ul></li><li><a class=list-link href=/notes/elasticsearch/ title=Elasticsearch>Elasticsearch</a></li><li><i data-feather=plus-circle></i><a class=list-link href=/notes/gcp/> GCP</a><ul><li><a class=list-link href=/notes/gcp/command/ title=command>command</a></li></ul></li><li><i data-feather=plus-circle></i><a class=list-link href=/notes/go/> Go</a><ul><li><a class=list-link href=/notes/go/libraries/ title=Libraries>Libraries</a></li><li><i data-feather=plus-circle></i><a class=list-link href=/notes/go/questions/> Questions</a><ul><li><a class=list-link href=/notes/go/questions/array/ title=Array>Array</a></li><li><a class=list-link href=/notes/go/questions/channel/ title=Channel>Channel</a></li><li><a class=list-link href=/notes/go/questions/context/ title=Context>Context</a></li><li><a class=list-link href=/notes/go/questions/defer/ title=Defer>Defer</a></li><li><a class=list-link href=/notes/go/questions/goroutine/ title=Goroutine>Goroutine</a></li><li><a class=list-link href=/notes/go/questions/interface/ title=Interface>Interface</a></li><li><a class=list-link href=/notes/go/questions/iota/ title=Iota>Iota</a></li><li><a class=list-link href=/notes/go/questions/json/ title=JSON>JSON</a></li><li><a class=list-link href=/notes/go/questions/len/ title=Len>Len</a></li><li><a class=list-link href=/notes/go/questions/map/ title=Map>Map</a></li><li><a class=list-link href=/notes/go/questions/print/ title=Print>Print</a></li><li><a class=list-link href=/notes/go/questions/race/ title=Race>Race</a></li><li><a class=list-link href=/notes/go/questions/select/ title=Select>Select</a></li><li><a class=list-link href=/notes/go/questions/slice/ title=Slice>Slice</a></li><li><a class=list-link href=/notes/go/questions/variable/ title=Variable>Variable</a></li></ul></li><li><a class=list-link href=/notes/go/snippet/ title=Snippet>Snippet</a></li><li><a class=list-link href=/notes/go/tools/ title=Tools>Tools</a></li></ul></li><li><a class=list-link href=/notes/input-method/ title=Input-Method>Input-Method</a></li></div></ul></div></div></div></section><section class=content-section id=content-section><div class="content container-fluid" id=content><div class="container-fluid note-card-holder" id=note-card-holder><div class=note-card><div class=item><h5 class=note-title><span>Lookup</span></h5><div class=card><div class=card-body><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># List all plugins</span>
</span></span><span style=display:flex><span>ansible-doc -t lookup -l
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Use `ansible-doc -t lookup &lt;plugin&gt;` to see detail</span>
</span></span><span style=display:flex><span>ansible-doc -t lookup ping
</span></span></code></pre></div></div></div></div></div><div class=note-card><div class=item><h5 class=note-title><span>winrm</span></h5><div class=card><div class=card-body><h6 id=--console-output>- console output</h6><p>在 hyper-v 那台機器 Enable Winrm 之後 一直出現下面的錯誤。
在 group 加上一行即可</p><p><code>ansible_winrm_transport=ntlm</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>hyper-v</span><span style=color:#ae81ff>01</span> <span style=color:#960050;background-color:#1e0010>|</span> <span style=color:#960050;background-color:#1e0010>UNREACHABLE!</span> <span style=color:#960050;background-color:#1e0010>=&gt;</span> {
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;changed&#34;</span>: <span style=color:#66d9ef>false</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;msg&#34;</span>: <span style=color:#e6db74>&#34;ssl: the specified credentials were rejected by the server&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;unreachable&#34;</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h6 id=--etcansiblehosts>- /etc/ansible/hosts</h6><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ini data-lang=ini><span style=display:flex><span><span style=color:#a6e22e>ansible_user</span><span style=color:#f92672>=</span><span style=color:#e6db74>administrator</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>ansible_password</span><span style=color:#f92672>=</span><span style=color:#e6db74>password</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>ansible_port</span><span style=color:#f92672>=</span><span style=color:#e6db74>5986</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>ansible_connection</span><span style=color:#f92672>=</span><span style=color:#e6db74>winrm</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>ansible_winrm_server_cert_validation</span><span style=color:#f92672>=</span><span style=color:#e6db74>ignore</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>ansible_winrm_transport</span><span style=color:#f92672>=</span><span style=color:#e6db74>ntlm</span>
</span></span></code></pre></div></div></div></div></div><div class=note-card><div class=item><h5 class=note-title><span>CloudFront</span></h5><div class=card><div class=card-body><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># list distributions</span>
</span></span><span style=display:flex><span>aws cloudfront list-distributions --query <span style=color:#e6db74>&#39;*.Items[*].[Comment,Id,Aliases.Items[0],DefaultCacheBehavior.TargetOriginId]&#39;</span> --output table
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># create invalidation</span>
</span></span><span style=display:flex><span>aws cloudfront create-invalidation --distribution-id  EATDVGD171BHDS1  --paths <span style=color:#e6db74>&#34;/*&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>## check cloudfornt log enable or not</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> i in <span style=color:#66d9ef>$(</span>aws cloudfront list-distributions --output table --query <span style=color:#e6db74>&#39;DistributionList.Items[*].Id&#39;</span> --profile route53 | sed <span style=color:#e6db74>&#39;1,3d;$d&#39;</span> | awk <span style=color:#e6db74>&#39;{print $2}&#39;</span><span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>do</span>
</span></span><span style=display:flex><span>  result<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>aws cloudfront get-distribution --id <span style=color:#e6db74>${</span>i<span style=color:#e6db74>}</span> --query <span style=color:#e6db74>&#39;Distribution.DistributionConfig.Logging&#39;</span> --profile route53 | jq .Enabled<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> <span style=color:#f92672>[[</span> <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>result<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span> !<span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;true&#34;</span> <span style=color:#f92672>]]</span>;<span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>    echo <span style=color:#e6db74>${</span>i<span style=color:#e6db74>}</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>done</span>
</span></span></code></pre></div></div></div></div></div><div class=note-card><div class=item><h5 class=note-title><span>EC2</span></h5><div class=card><div class=card-body><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># list</span>
</span></span><span style=display:flex><span>aws ec2 describe-instances --query <span style=color:#e6db74>&#39;Reservations[*].Instances[*].[Tags[0].Value,InstanceId]&#39;</span> --output table --page-size <span style=color:#ae81ff>100</span>
</span></span></code></pre></div></div></div></div></div><div class=note-card><div class=item><h5 class=note-title><span>ECR</span></h5><div class=card><div class=card-body><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># Get password and login to 12345.dkr.ecr.ap-northeast-1.amazonaws.com</span>
</span></span><span style=display:flex><span>aws ecr get-login-password | docker login --username AWS --password-stdin 12345.dkr.ecr.ap-northeast-1.amazonaws.com
</span></span></code></pre></div></div></div></div></div><div class=note-card><div class=item><h5 class=note-title><span>S3</span></h5><div class=card><div class=card-body><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># Copy local file to S3</span>
</span></span><span style=display:flex><span>aws s3 cp ./pic.png s3://bucket_name/dir/
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Sync local local_dir to S3</span>
</span></span><span style=display:flex><span>aws s3 sync local_dir s3://bucket_name --exclude <span style=color:#e6db74>&#39;gameConfig.json&#39;</span> --acl public-read --delete
</span></span></code></pre></div></div></div></div></div><div class=note-card><div class=item><h5 class=note-title><span>snapshot</span></h5><div class=card><div class=card-body><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># list</span>
</span></span><span style=display:flex><span>aws ec2 describe-snapshots <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>        --owner-ids self <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>        --query <span style=color:#e6db74>&#34;Snapshots[?(Tags[0].Value==&#39;backend&#39;)].[SnapshotId,VolumeId]&#34;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>        --region ap-northeast-1
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># create</span>
</span></span><span style=display:flex><span>aws ec2 create-snapshot --volume-id vol-02468851c2bc3bc4b --description <span style=color:#e6db74>&#34;gitlab-</span><span style=color:#66d9ef>$(</span>date +%F<span style=color:#66d9ef>)</span><span style=color:#e6db74>&#34;</span> --region ap-northeast-1
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># delete</span>
</span></span><span style=display:flex><span>aws ec2 delete-snapshot --snapshot-id snap-1234567890abcdef0 --region ap-northeast-1
</span></span></code></pre></div></div></div></div></div><div class=note-card><div class=item><h5 class=note-title><span>sns</span></h5><div class=card><div class=card-body><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>region<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;ap-east-1&#39;</span>
</span></span><span style=display:flex><span>account_id<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;888886666321&#39;</span>
</span></span><span style=display:flex><span>topic<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;sa&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># create topic</span>
</span></span><span style=display:flex><span>aws sns create-topic --name <span style=color:#e6db74>${</span>topic<span style=color:#e6db74>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># subscribe</span>
</span></span><span style=display:flex><span>aws sns subscribe --topic-arn arn:aws:sns:<span style=color:#e6db74>${</span>region<span style=color:#e6db74>}</span>:<span style=color:#e6db74>${</span>account_id<span style=color:#e6db74>}</span>:<span style=color:#e6db74>${</span>topic<span style=color:#e6db74>}</span> --protocol email --notification-endpoint ricky@gmail.com
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># list</span>
</span></span><span style=display:flex><span>aws sns list-subscriptions-by-topic --topic-arn arn:aws:sns:<span style=color:#e6db74>${</span>region<span style=color:#e6db74>}</span>:<span style=color:#e6db74>${</span>account_id<span style=color:#e6db74>}</span>:<span style=color:#e6db74>${</span>topic<span style=color:#e6db74>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># create alarm</span>
</span></span><span style=display:flex><span><span style=color:#75715e>### metric-name</span>
</span></span><span style=display:flex><span><span style=color:#75715e>##CPUUtilization --&gt;percent</span>
</span></span><span style=display:flex><span><span style=color:#75715e>##NetworkIn --&gt;bytes</span>
</span></span><span style=display:flex><span><span style=color:#75715e>##NetworkOut --&gt;bytes</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> line in <span style=color:#66d9ef>$(</span>aws ec2 describe-instances --query <span style=color:#e6db74>&#39;Reservations[*].Instances[*].[Tags[0].Value,InstanceId]&#39;</span> --output table --page-size 100<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>do</span>
</span></span><span style=display:flex><span>    ID<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>echo <span style=color:#e6db74>${</span>line<span style=color:#e6db74>}</span>|awk -F <span style=color:#e6db74>&#39;,&#39;</span> <span style=color:#e6db74>&#39;{print $1}&#39;</span><span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>    VALUE<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>echo <span style=color:#e6db74>${</span>line<span style=color:#e6db74>}</span>|awk -F <span style=color:#e6db74>&#39;,&#39;</span> <span style=color:#e6db74>&#39;{print $2}&#39;</span><span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>    aws cloudwatch put-metric-alarm <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>        --alarm-name <span style=color:#e6db74>${</span>ID<span style=color:#e6db74>}</span>_netout <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>        --metric-name NetworkOut <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>        --namespace AWS/EC2 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>        --statistic Average <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>        --period <span style=color:#ae81ff>300</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>        --threshold <span style=color:#ae81ff>2560000</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>        --comparison-operator GreaterThanOrEqualToThreshold <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>        --dimensions  <span style=color:#e6db74>&#34;Name=InstanceId,Value=</span><span style=color:#e6db74>${</span>VALUE<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>        --evaluation-periods <span style=color:#ae81ff>3</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>        --alarm-actions arn:aws:sns:<span style=color:#e6db74>${</span>region<span style=color:#e6db74>}</span>:<span style=color:#e6db74>${</span>account_id<span style=color:#e6db74>}</span>:<span style=color:#e6db74>${</span>topic<span style=color:#e6db74>}</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>##--unit Bytes</span>
</span></span><span style=display:flex><span>    echo <span style=color:#e6db74>&#34;</span>$ID<span style=color:#e6db74> done&#34;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>done</span>
</span></span></code></pre></div></div></div></div></div><div class=note-card><div class=item><h5 class=note-title><span>WAF</span></h5><div class=card><div class=card-body><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>aws wafv2 create-web-acl <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --name acl_name <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --scope CLOUDFRONT <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --default-action Allow<span style=color:#f92672>={}</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --visibility-config SampledRequestsEnabled<span style=color:#f92672>=</span>true,CloudWatchMetricsEnabled<span style=color:#f92672>=</span>true,MetricName<span style=color:#f92672>=</span>metric_acl_name <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --rule
</span></span></code></pre></div></div></div></div></div><div class=note-card><div class=item><h5 class=note-title><span>Mount S3 Bucket on EC2</span></h5><div class=card><div class=card-body><p>references: <a href=https://linuxbeast.com/blog/how-to-mount-s3-bucket-on-ubuntu-22-04-with-s3fs-fuse/ target=_blank rel=noopener>How to Mount S3 Bucket on Ubuntu 22.04 with S3FS Fuse</a></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># Installing s3fs-fuse</span>
</span></span><span style=display:flex><span>sudo apt-get update <span style=color:#f92672>&amp;&amp;</span> sudo apt-get install s3fs
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Configuring AWS Credentials</span>
</span></span><span style=display:flex><span>echo ACCESS_KEY_ID:SECRET_ACCESS_KEY &gt; <span style=color:#e6db74>${</span>HOME<span style=color:#e6db74>}</span>/.passwd-s3fs
</span></span><span style=display:flex><span>chmod <span style=color:#ae81ff>600</span> <span style=color:#e6db74>${</span>HOME<span style=color:#e6db74>}</span>/.passwd-s3fs
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Mounting the S3 Bucket</span>
</span></span><span style=display:flex><span>s3fs mybucketname:/path/to/dir /path/to/local/mountpoint -o passwd_file<span style=color:#f92672>=</span><span style=color:#e6db74>${</span>HOME<span style=color:#e6db74>}</span>/.passwd-s3fs
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Ensuring Persistent Mounting</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#39;s3fs#mybucketname:/path/to/dir /path/to/local/mountpoint fuse _netdev,allow_other 0 0&#39;</span> | sudo tee -a /etc/fstab
</span></span></code></pre></div></div></div></div></div><div class=note-card><div class=item><h5 class=note-title><span>resize disk</span></h5><div class=card><div class=card-body><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># 會在 FSTYPE 欄顯示 ext4 或 xfs</span>
</span></span><span style=display:flex><span>lsblk -f
</span></span><span style=display:flex><span><span style=color:#75715e># 擴大分割區 1 直到填滿整顆磁碟</span>
</span></span><span style=display:flex><span><span style=color:#75715e># apt-get -y install cloud-guest-utils   # 內含 growpart</span>
</span></span><span style=display:flex><span>growpart /dev/xvda <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span><span style=color:#75715e># ext4 # xfs_growfs -d / # xfs</span>
</span></span><span style=display:flex><span>resize2fs /dev/xvda1
</span></span></code></pre></div></div></div></div></div><div class=note-card><div class=item><h5 class=note-title><span>S3 Bucket Policy</span></h5><div class=card><div class=card-body><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>	<span style=color:#f92672>&#34;Version&#34;</span>: <span style=color:#e6db74>&#34;2012-10-17&#34;</span>,
</span></span><span style=display:flex><span>	<span style=color:#f92672>&#34;Statement&#34;</span>: [
</span></span><span style=display:flex><span>		{
</span></span><span style=display:flex><span>			<span style=color:#f92672>&#34;Sid&#34;</span>: <span style=color:#e6db74>&#34;AllowPublicRead&#34;</span>,
</span></span><span style=display:flex><span>			<span style=color:#f92672>&#34;Effect&#34;</span>: <span style=color:#e6db74>&#34;Allow&#34;</span>,
</span></span><span style=display:flex><span>			<span style=color:#f92672>&#34;Principal&#34;</span>: <span style=color:#e6db74>&#34;*&#34;</span>,
</span></span><span style=display:flex><span>			<span style=color:#f92672>&#34;Action&#34;</span>: <span style=color:#e6db74>&#34;s3:GetObject&#34;</span>,
</span></span><span style=display:flex><span>			<span style=color:#f92672>&#34;Resource&#34;</span>: <span style=color:#e6db74>&#34;arn:aws:s3:::bucketName/*&#34;</span>
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>	]
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></div></div></div></div><div class=note-card><div class=item><h5 class=note-title><span>S3 CORS</span></h5><div class=card><div class=card-body><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>[
</span></span><span style=display:flex><span>	{
</span></span><span style=display:flex><span>		<span style=color:#f92672>&#34;AllowedHeaders&#34;</span>: [<span style=color:#e6db74>&#34;*&#34;</span>],
</span></span><span style=display:flex><span>		<span style=color:#f92672>&#34;AllowedMethods&#34;</span>: [<span style=color:#e6db74>&#34;GET&#34;</span>, <span style=color:#e6db74>&#34;PUT&#34;</span>, <span style=color:#e6db74>&#34;POST&#34;</span>, <span style=color:#e6db74>&#34;DELETE&#34;</span>],
</span></span><span style=display:flex><span>		<span style=color:#f92672>&#34;AllowedOrigins&#34;</span>: [<span style=color:#e6db74>&#34;*&#34;</span>],
</span></span><span style=display:flex><span>		<span style=color:#f92672>&#34;ExposeHeaders&#34;</span>: [
</span></span><span style=display:flex><span>			<span style=color:#e6db74>&#34;x-amz-server-side-encryption&#34;</span>,
</span></span><span style=display:flex><span>			<span style=color:#e6db74>&#34;x-amz-request-id&#34;</span>,
</span></span><span style=display:flex><span>			<span style=color:#e6db74>&#34;x-amz-id-2&#34;</span>
</span></span><span style=display:flex><span>		],
</span></span><span style=display:flex><span>		<span style=color:#f92672>&#34;MaxAgeSeconds&#34;</span>: <span style=color:#ae81ff>3000</span>
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>]
</span></span></code></pre></div></div></div></div></div><div class=note-card><div class=item><h5 class=note-title><span>ECR Lifecycle Policy</span></h5><div class=card><div class=card-body><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>	<span style=color:#f92672>&#34;rules&#34;</span>: [
</span></span><span style=display:flex><span>		{
</span></span><span style=display:flex><span>			<span style=color:#f92672>&#34;rulePriority&#34;</span>: <span style=color:#ae81ff>1</span>,
</span></span><span style=display:flex><span>			<span style=color:#f92672>&#34;description&#34;</span>: <span style=color:#e6db74>&#34;Keep only the last 100 images&#34;</span>,
</span></span><span style=display:flex><span>			<span style=color:#f92672>&#34;selection&#34;</span>: {
</span></span><span style=display:flex><span>				<span style=color:#f92672>&#34;tagStatus&#34;</span>: <span style=color:#e6db74>&#34;any&#34;</span>,
</span></span><span style=display:flex><span>				<span style=color:#f92672>&#34;countType&#34;</span>: <span style=color:#e6db74>&#34;imageCountMoreThan&#34;</span>,
</span></span><span style=display:flex><span>				<span style=color:#f92672>&#34;countNumber&#34;</span>: <span style=color:#ae81ff>100</span>
</span></span><span style=display:flex><span>			},
</span></span><span style=display:flex><span>			<span style=color:#f92672>&#34;action&#34;</span>: {
</span></span><span style=display:flex><span>				<span style=color:#f92672>&#34;type&#34;</span>: <span style=color:#e6db74>&#34;expire&#34;</span>
</span></span><span style=display:flex><span>			}
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>	]
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></div></div></div></div><div class=note-card><div class=item><h5 class=note-title><span>ECR Lifecycle Policy1</span></h5><div class=card><div class=card-body><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>	<span style=color:#f92672>&#34;rules&#34;</span>: [
</span></span><span style=display:flex><span>		{
</span></span><span style=display:flex><span>			<span style=color:#f92672>&#34;rulePriority&#34;</span>: <span style=color:#ae81ff>1</span>,
</span></span><span style=display:flex><span>			<span style=color:#f92672>&#34;description&#34;</span>: <span style=color:#e6db74>&#34;Remove images with certain tag&#34;</span>,
</span></span><span style=display:flex><span>			<span style=color:#f92672>&#34;selection&#34;</span>: {
</span></span><span style=display:flex><span>				<span style=color:#f92672>&#34;tagStatus&#34;</span>: <span style=color:#e6db74>&#34;tagged&#34;</span>,
</span></span><span style=display:flex><span>				<span style=color:#f92672>&#34;tagPrefixList&#34;</span>: [<span style=color:#e6db74>&#34;tag1&#34;</span>, <span style=color:#e6db74>&#34;tag2&#34;</span>],
</span></span><span style=display:flex><span>				<span style=color:#f92672>&#34;countType&#34;</span>: <span style=color:#e6db74>&#34;imageCountMoreThan&#34;</span>,
</span></span><span style=display:flex><span>				<span style=color:#f92672>&#34;countNumber&#34;</span>: <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>			},
</span></span><span style=display:flex><span>			<span style=color:#f92672>&#34;action&#34;</span>: {
</span></span><span style=display:flex><span>				<span style=color:#f92672>&#34;type&#34;</span>: <span style=color:#e6db74>&#34;expire&#34;</span>
</span></span><span style=display:flex><span>			}
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>	]
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></div></div></div></div><div class=note-card><div class=item><h5 class=note-title><span>ECR Lifecycle Policy2</span></h5><div class=card><div class=card-body><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>	<span style=color:#f92672>&#34;rules&#34;</span>: [
</span></span><span style=display:flex><span>		{
</span></span><span style=display:flex><span>			<span style=color:#f92672>&#34;rulePriority&#34;</span>: <span style=color:#ae81ff>1</span>,
</span></span><span style=display:flex><span>			<span style=color:#f92672>&#34;description&#34;</span>: <span style=color:#e6db74>&#34;Remove untagged images older than 14 days&#34;</span>,
</span></span><span style=display:flex><span>			<span style=color:#f92672>&#34;selection&#34;</span>: {
</span></span><span style=display:flex><span>				<span style=color:#f92672>&#34;tagStatus&#34;</span>: <span style=color:#e6db74>&#34;untagged&#34;</span>,
</span></span><span style=display:flex><span>				<span style=color:#f92672>&#34;countType&#34;</span>: <span style=color:#e6db74>&#34;sinceImagePushed&#34;</span>,
</span></span><span style=display:flex><span>				<span style=color:#f92672>&#34;countUnit&#34;</span>: <span style=color:#e6db74>&#34;days&#34;</span>,
</span></span><span style=display:flex><span>				<span style=color:#f92672>&#34;countNumber&#34;</span>: <span style=color:#ae81ff>14</span>
</span></span><span style=display:flex><span>			},
</span></span><span style=display:flex><span>			<span style=color:#f92672>&#34;action&#34;</span>: {
</span></span><span style=display:flex><span>				<span style=color:#f92672>&#34;type&#34;</span>: <span style=color:#e6db74>&#34;expire&#34;</span>
</span></span><span style=display:flex><span>			}
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>	]
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></div></div></div></div><div class=note-card><div class=item><h5 class=note-title><span>tf</span></h5><div class=card><div class=card-body><h5 id=provider>Provider</h5><ul><li><a href=/notes/aws/terraform/hcl/provider.tf>provider.tf</a></li></ul><h5 id=ec2>EC2</h5><ul><li><a href=/notes/aws/terraform/hcl/ec2.tf>ec2.tf</a></li><li><a href=/notes/aws/terraform/hcl/initial.bash>initial.bash</a></li></ul><h5 id=elastic-ip>Elastic IP</h5><ul><li><a href=/notes/aws/terraform/hcl/elasticip.tf>elasticip.tf</a></li></ul><h5 id=mq>MQ</h5><ul><li><a href=/notes/aws/terraform/hcl/mq.tf>mq.tf</a></li></ul><h5 id=rds>RDS</h5><ul><li><a href=/notes/aws/terraform/hcl/rds.tf>rds.tf</a></li></ul><h5 id=security-group>Security Group</h5><ul><li><a href=/notes/aws/terraform/hcl/sg.tf>sg.tf</a></li></ul><h5 id=vpc>VPC</h5><ul><li><a href=/notes/aws/terraform/hcl/vpc.tf>vpc.tf</a></li></ul><h5 id=waf>WAF</h5><ul><li><a href=/notes/aws/terraform/hcl/waf.tf>waf.tf</a></li></ul></div></div></div></div><div class=note-card><div class=item><h5 class=note-title><span>Setting CloudFlare Worker for CORS</span></h5><div class=card><div class=card-body><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#a6e22e>addEventListener</span>(<span style=color:#e6db74>&#34;fetch&#34;</span>, (<span style=color:#a6e22e>event</span>) =&gt; {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>event</span>.<span style=color:#a6e22e>respondWith</span>(<span style=color:#a6e22e>handleRequest</span>(<span style=color:#a6e22e>event</span>.<span style=color:#a6e22e>request</span>));
</span></span><span style=display:flex><span>});
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>async</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>handleRequest</span>(<span style=color:#a6e22e>request</span>) {
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>response</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>fetch</span>(<span style=color:#a6e22e>request</span>);
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>response</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Response</span>(<span style=color:#a6e22e>response</span>.<span style=color:#a6e22e>body</span>, <span style=color:#a6e22e>response</span>);
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>response</span>.<span style=color:#a6e22e>headers</span>.<span style=color:#a6e22e>set</span>(
</span></span><span style=display:flex><span>		<span style=color:#e6db74>&#34;Access-Control-Allow-Origin&#34;</span>,
</span></span><span style=display:flex><span>		<span style=color:#e6db74>&#34;frontend-h5.shyc883.com&#34;</span>
</span></span><span style=display:flex><span>	);
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>response</span>.<span style=color:#a6e22e>headers</span>.<span style=color:#a6e22e>set</span>(<span style=color:#e6db74>&#34;Access-Control-Allow-Methods&#34;</span>, <span style=color:#e6db74>&#34;GET, OPTIONS, POST&#34;</span>);
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>response</span>.<span style=color:#a6e22e>headers</span>.<span style=color:#a6e22e>set</span>(
</span></span><span style=display:flex><span>		<span style=color:#e6db74>&#34;Access-Control-Allow-Headers&#34;</span>,
</span></span><span style=display:flex><span>		<span style=color:#e6db74>&#34;Content-Type, Authorization&#34;</span>
</span></span><span style=display:flex><span>	);
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>response</span>.<span style=color:#a6e22e>headers</span>.<span style=color:#a6e22e>set</span>(<span style=color:#e6db74>&#34;Access-Control-Allow-Credentials&#34;</span>, <span style=color:#66d9ef>true</span>);
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>response</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></div></div></div></div><div class=note-card><div class=item><h5 class=note-title><span>Terraform_create_record</span></h5><div class=card><div class=card-body><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-hcl data-lang=hcl><span style=display:flex><span><span style=color:#66d9ef>terraform</span> {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>required_providers</span> {
</span></span><span style=display:flex><span>    cloudflare <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>      source <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;cloudflare/cloudflare&#34;</span>
</span></span><span style=display:flex><span>      version <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;~&gt; 2.0&#34;</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>provider</span> <span style=color:#e6db74>&#34;cloudflare&#34;</span> {
</span></span><span style=display:flex><span>  email   <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;cloudflare@gmail.com&#34;</span>
</span></span><span style=display:flex><span>  api_key <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;1488ed0d2082ed36c010b773431fd9dcacde1&#34;</span>
</span></span><span style=display:flex><span>  account_id <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;06ae012a1ba907df24a220cd14a4fa8b&#34;</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>resource</span> <span style=color:#e6db74>&#34;cloudflare_record&#34; &#34;gitlab&#34;</span> {
</span></span><span style=display:flex><span>  zone_id <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;92c6d5010fbacab27d464f4d79c11fce&#34;</span>
</span></span><span style=display:flex><span>  name    <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;gitlab&#34;</span>
</span></span><span style=display:flex><span>  value   <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;192.123.168.234&#34;</span>
</span></span><span style=display:flex><span>  type    <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;A&#34;</span>
</span></span><span style=display:flex><span>  ttl     <span style=color:#f92672>=</span> <span style=color:#ae81ff>300</span>
</span></span><span style=display:flex><span>  proxied <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></div></div></div></div><div class=note-card><div class=item><h5 class=note-title><span>Terraform_create_page_rule</span></h5><div class=card><div class=card-body><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-hcl data-lang=hcl><span style=display:flex><span><span style=color:#75715e># Add a page rule to the domain
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>resource</span> <span style=color:#e6db74>&#34;cloudflare_page_rule&#34; &#34;page_rule_png&#34;</span> {
</span></span><span style=display:flex><span>  zone_id <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;92c6d5010fbacab27d464f4d79c11fce&#34;</span>
</span></span><span style=display:flex><span>  target <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;www.example.com/*.png*&#34;</span>
</span></span><span style=display:flex><span>  status   <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;active&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>actions</span> {
</span></span><span style=display:flex><span>    always_use_https <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;true&#34;</span>
</span></span><span style=display:flex><span>    browser_cache_ttl <span style=color:#f92672>=</span> <span style=color:#ae81ff>86400</span>
</span></span><span style=display:flex><span>    cache_level <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;cache_everything&#34;</span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>    # edge_cache_ttl = 86400
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>cache_key_fields</span> {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>cookie</span> {}
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>header</span> {}
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>host</span> {}
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>query_string</span> {
</span></span><span style=display:flex><span>        ignore <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>user</span> {}
</span></span><span style=display:flex><span>    }<span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>  #   cache_ttl_by_status {
</span></span></span><span style=display:flex><span><span style=color:#75715e>  #           codes = &#34;200-299&#34;
</span></span></span><span style=display:flex><span><span style=color:#75715e>  #           ttl = 300
</span></span></span><span style=display:flex><span><span style=color:#75715e>  #       }
</span></span></span><span style=display:flex><span><span style=color:#75715e>  #       cache_ttl_by_status {
</span></span></span><span style=display:flex><span><span style=color:#75715e>  #           codes = &#34;300-399&#34;
</span></span></span><span style=display:flex><span><span style=color:#75715e>  #           ttl = 60
</span></span></span><span style=display:flex><span><span style=color:#75715e>  #       }
</span></span></span><span style=display:flex><span><span style=color:#75715e>  #       cache_ttl_by_status {
</span></span></span><span style=display:flex><span><span style=color:#75715e>  #           codes = &#34;400-403&#34;
</span></span></span><span style=display:flex><span><span style=color:#75715e>  #           ttl = -1
</span></span></span><span style=display:flex><span><span style=color:#75715e>  #       }
</span></span></span><span style=display:flex><span><span style=color:#75715e>  #       cache_ttl_by_status {
</span></span></span><span style=display:flex><span><span style=color:#75715e>  #           codes = &#34;404&#34;
</span></span></span><span style=display:flex><span><span style=color:#75715e>  #           ttl = 30
</span></span></span><span style=display:flex><span><span style=color:#75715e>  #       }
</span></span></span><span style=display:flex><span><span style=color:#75715e>  #       cache_ttl_by_status {
</span></span></span><span style=display:flex><span><span style=color:#75715e>  #           codes = &#34;405-499&#34;
</span></span></span><span style=display:flex><span><span style=color:#75715e>  #           ttl = -1
</span></span></span><span style=display:flex><span><span style=color:#75715e>  #       }
</span></span></span><span style=display:flex><span><span style=color:#75715e>  #       cache_ttl_by_status {
</span></span></span><span style=display:flex><span><span style=color:#75715e>  #           codes = &#34;500-599&#34;
</span></span></span><span style=display:flex><span><span style=color:#75715e>  #           ttl = 0
</span></span></span><span style=display:flex><span><span style=color:#75715e>  #       }
</span></span></span><span style=display:flex><span><span style=color:#75715e>  # }
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>}<span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e># resource &#34;cloudflare_page_rule&#34; &#34;rules&#34; {
</span></span></span><span style=display:flex><span><span style=color:#75715e>#   count = &#34;${length(keys(&#34;${var.targets}&#34;))}&#34;
</span></span></span><span style=display:flex><span><span style=color:#75715e>#   lifecycle {
</span></span></span><span style=display:flex><span><span style=color:#75715e>#     create_before_destroy = true
</span></span></span><span style=display:flex><span><span style=color:#75715e>#   }
</span></span></span><span style=display:flex><span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>#   zone_id = &#34;92c6d5010fbacab27d464f4d79c11fce&#34;
</span></span></span><span style=display:flex><span><span style=color:#75715e>#   target = &#34;${var.targets[element(keys(var.targets),count.index)]}&#34;
</span></span></span><span style=display:flex><span><span style=color:#75715e>#   actions {
</span></span></span><span style=display:flex><span><span style=color:#75715e>#     always_use_https = &#34;true&#34;
</span></span></span><span style=display:flex><span><span style=color:#75715e>#     cache_level = &#34;cache_everything&#34;
</span></span></span><span style=display:flex><span><span style=color:#75715e>#   }
</span></span></span><span style=display:flex><span><span style=color:#75715e>#   priority = &#34;${count.index + 1}&#34;
</span></span></span><span style=display:flex><span><span style=color:#75715e># }
</span></span></span></code></pre></div></div></div></div></div><div class=note-card><div class=item><h5 class=note-title><span>Terraform_create_rate_limit_rule</span></h5><div class=card><div class=card-body><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-hcl data-lang=hcl><span style=display:flex><span><span style=color:#75715e># Create rate limit rule
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>resource</span> <span style=color:#e6db74>&#34;cloudflare_rate_limit&#34; &#34;wss_rate_limit&#34;</span> {
</span></span><span style=display:flex><span>  zone_id <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;92c6d5010fbacab27d464f4d79c11fce&#34;</span>
</span></span><span style=display:flex><span>  threshold <span style=color:#f92672>=</span> <span style=color:#ae81ff>50</span>
</span></span><span style=display:flex><span>  period <span style=color:#f92672>=</span> <span style=color:#ae81ff>60</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>match</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>request</span> {
</span></span><span style=display:flex><span>      url_pattern <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;*wss*/*&#34;</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>action</span> {
</span></span><span style=display:flex><span>    mode <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;ban&#34;</span>
</span></span><span style=display:flex><span>    timeout <span style=color:#f92672>=</span> <span style=color:#ae81ff>3600</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>correlate</span> {
</span></span><span style=display:flex><span>    by <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;nat&#34;</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>resource</span> <span style=color:#e6db74>&#34;cloudflare_rate_limit&#34; &#34;frontend_rate_limit&#34;</span> {
</span></span><span style=display:flex><span>  zone_id <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;92c6d5010fbacab27d464f4d79c11fce&#34;</span>
</span></span><span style=display:flex><span>  threshold <span style=color:#f92672>=</span> <span style=color:#ae81ff>50</span>
</span></span><span style=display:flex><span>  period <span style=color:#f92672>=</span> <span style=color:#ae81ff>10</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>match</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>request</span> {
</span></span><span style=display:flex><span>      url_pattern <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;*h5*/*&#34;</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>action</span> {
</span></span><span style=display:flex><span>    mode <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;ban&#34;</span>
</span></span><span style=display:flex><span>    timeout <span style=color:#f92672>=</span> <span style=color:#ae81ff>3600</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>correlate</span> {
</span></span><span style=display:flex><span>    by <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;nat&#34;</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></div></div></div></div><div class=note-card><div class=item><h5 class=note-title><span>API Document</span></h5><div class=card><div class=card-body><ul><li><a href=https://developers.cloudflare.com/api/operations/custom-hostname-for-a-zone-create-custom-hostname target=_blank rel=noopener>Cloudflare for SaaS</a></li><li><a href=https://developers.cloudflare.com/api/operations/dns-records-for-a-zone-create-dns-record target=_blank rel=noopener>partial (CNAME) zone</a></li></ul></div></div></div></div><div class=note-card><div class=item><h5 class=note-title><span>ab</span></h5><div class=card><div class=card-body><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ab -n <span style=color:#ae81ff>20</span> -c <span style=color:#ae81ff>20</span> -k https://default.hddv1.com/error
</span></span></code></pre></div></div></div></div></div><div class=note-card><div class=item><h5 class=note-title><span>age</span></h5><div class=card><div class=card-body><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># generate public and private keys</span>
</span></span><span style=display:flex><span>age-keygen -o key.txt
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># encrypt file with public key</span>
</span></span><span style=display:flex><span>age -r public_key -o file.txt.enc file.txt
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># encrypt file with ssh key</span>
</span></span><span style=display:flex><span>age -R ~/.ssh/id_ed25519.pub file.txt &gt; file.txt.enc
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># decrypt file</span>
</span></span><span style=display:flex><span>age --decrypt -i key.txt file.txt.enc &gt; file.txt
</span></span></code></pre></div></div></div></div></div><div class=note-card><div class=item><h5 class=note-title><span>awk</span></h5><div class=card><div class=card-body><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># To lowercase</span>
</span></span><span style=display:flex><span>uuidgen|awk <span style=color:#e6db74>&#39;{print tolower($0)}&#39;</span> <span style=color:#75715e># output: 649612b0-0fa4-4b50-9b13-17279f602a43</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># To uppercase</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#39;hello world&#39;</span>|awk <span style=color:#e6db74>&#39;{print toupper($0)}&#39;</span> <span style=color:#75715e># output: HELLO WORLD</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 提取子字符串: `substr(string, start, length)`</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;hello world&#34;</span> | awk <span style=color:#e6db74>&#39;{print substr($0, 1, 5)}&#39;</span> <span style=color:#75715e># output: hello</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 全局替換字符串中的正則表達式匹配項: `gsub(regex, replacement, string)`</span>
</span></span><span style=display:flex><span><span style=color:#75715e># 替換字符串中首次匹配的正則表達式: `sub(regex, replacement, string)`</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;hello world&#34;</span> | awk <span style=color:#e6db74>&#39;{gsub(/world/, &#34;everyone&#34;); print $0}&#39;</span> <span style=color:#75715e># output: hello everyone</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 將數字轉換為整數</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;3.14&#34;</span> | awk <span style=color:#e6db74>&#39;{print int($0)}&#39;</span> <span style=color:#75715e># output: 3</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 返回平方根</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;99&#34;</span> | awk <span style=color:#e6db74>&#39;{print sqrt($0)}&#39;</span> <span style=color:#75715e># output: 9.94987</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 指數和對數</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;2&#34;</span> | awk <span style=color:#e6db74>&#39;{print exp($0), log($0)}&#39;</span> <span style=color:#75715e># output: 7.38906 0.693147</span>
</span></span></code></pre></div></div></div></div></div><div class=note-card><div class=item><h5 class=note-title><span>caffeinate</span></h5><div class=card><div class=card-body><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># 防止显示器关闭</span>
</span></span><span style=display:flex><span>caffeinate -d
</span></span><span style=display:flex><span><span style=color:#75715e># 保持系统不休眠</span>
</span></span><span style=display:flex><span>caffeinate -i
</span></span><span style=display:flex><span><span style=color:#75715e># 保持 30 分钟</span>
</span></span><span style=display:flex><span>caffeinate -t <span style=color:#ae81ff>1800</span>
</span></span></code></pre></div></div></div></div></div><div class=note-card><div class=item><h5 class=note-title><span>certbot</span></h5><div class=card><div class=card-body><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># Install</span>
</span></span><span style=display:flex><span>sudo apt install certbot python3-certbot-nginx python3-certbot-dns-route53
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 1. Generating Wildcard Certificates</span>
</span></span><span style=display:flex><span>sudo certbot certonly --manual --preferred-challenges<span style=color:#f92672>=</span>dns --server https://acme-v02.api.letsencrypt.org/directory --agree-tos -d *.example.com
</span></span><span style=display:flex><span><span style=color:#75715e>### add txt record then press enter to continue</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 2. Generating Wildcard Certificates</span>
</span></span><span style=display:flex><span>sudo certbot certonly -d example.com -d *.example.com --dns-route53 --agree-tos --server https://acme-v02.api.letsencrypt.org/directory
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Automating Renewal</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>0</span> <span style=color:#ae81ff>0</span> * * <span style=color:#ae81ff>1</span> /usr/bin/certbot certonly --dns-route53 -d *.example.com --quiet --post-hook <span style=color:#e6db74>&#34;systemctl reload nginx&#34;</span>
</span></span></code></pre></div></div></div></div></div><div class=note-card><div class=item><h5 class=note-title><span>cutycapt</span></h5><div class=card><div class=card-body><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># Capture website page as picture</span>
</span></span><span style=display:flex><span>xvfb-run --server-args<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;-screen 0, 1024x768x24&#34;</span> cutycapt --url<span style=color:#f92672>=</span>https://www.google.com --out<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;/tmp/google.png&#34;</span>
</span></span></code></pre></div></div></div></div></div><div class=note-card><div class=item><h5 class=note-title><span>dmesg</span></h5><div class=card><div class=card-body><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo dmesg -T | grep -i <span style=color:#e6db74>&#39;killed process&#39;</span>
</span></span><span style=display:flex><span><span style=color:#75715e># total-vm: 該程序分配的虛擬記憶體總量（含未實際使用）</span>
</span></span><span style=display:flex><span><span style=color:#75715e># anon-rss: 匿名頁面 resident memory（實際佔用記憶體）→ 重點</span>
</span></span><span style=display:flex><span><span style=color:#75715e># file-rss: 映射檔案的 resident memory（如 shared libraries）</span>
</span></span><span style=display:flex><span><span style=color:#75715e># shmem-rss: 共用記憶體的 resident memory</span>
</span></span></code></pre></div></div></div></div></div><div class=note-card><div class=item><h5 class=note-title><span>dnscontrol</span></h5><div class=card><div class=card-body><ul><li><a href=/notes/bash/common/files/creds.json>creds.json</a></li><li>command</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>dnscontrol get-zones --format<span style=color:#f92672>=</span>js --out<span style=color:#f92672>=</span>example.com.js r53 ROUTE53 example.com
</span></span><span style=display:flex><span>dnscontrol get-zones --format<span style=color:#f92672>=</span>js --out<span style=color:#f92672>=</span>example.com.js cloudflare CLOUDFLAREAPI example.com
</span></span></code></pre></div></div></div></div></div><div class=note-card><div class=item><h5 class=note-title><span>ffmpeg</span></h5><div class=card><div class=card-body><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># Download sample video</span>
</span></span><span style=display:flex><span>wget https://www.sample-videos.com/video321/mp4/720/big_buck_bunny_720p_1mb.mp4 -O test.mp4
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Push stream</span>
</span></span><span style=display:flex><span>ffmpeg -re -i test.mp4 -c copy -f flv <span style=color:#e6db74>&#34;rtmp://209357.push.tlivecloud.com/live/big_buck_bunny_720p_1mb?txSecret=a543b79d9a8c38ace5ce18eea2bd7721&amp;txTime=687E4609&#34;</span>
</span></span></code></pre></div></div></div></div></div><div class=note-card><div class=item><h5 class=note-title><span>go</span></h5><div class=card><div class=card-body><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>go tool pprof -http<span style=color:#f92672>=</span>:8081 20250814_024534.heap
</span></span></code></pre></div></div></div></div></div><div class=note-card><div class=item><h5 class=note-title><span>k6</span></h5><div class=card><div class=card-body><ul><li><a href=/notes/bash/common/files/k6.js>k6.js</a></li><li>command</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>k6 run k6.js
</span></span></code></pre></div></div></div></div></div><div class=note-card><div class=item><h5 class=note-title><span>kafka</span></h5><div class=card><div class=card-body><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># list topics</span>
</span></span><span style=display:flex><span>kafka-topics.sh --bootstrap-server 127.0.0.1:9094 --list
</span></span><span style=display:flex><span><span style=color:#75715e># all topics count</span>
</span></span><span style=display:flex><span>kafka-topics.sh --bootstrap-server 127.0.0.1:9094 --list |wc -l
</span></span></code></pre></div></div></div></div></div><div class=note-card><div class=item><h5 class=note-title><span>hey</span></h5><div class=card><div class=card-body><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>hey -n <span style=color:#ae81ff>200000</span> -c <span style=color:#ae81ff>500</span> -h2 -z 30s https://a8-wss.hddv1.com/test
</span></span></code></pre></div></div></div></div></div><div class=note-card><div class=item><h5 class=note-title><span>openfortivpn</span></h5><div class=card><div class=card-body><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># https://github.com/adrienverge/openfortivpn</span>
</span></span><span style=display:flex><span>sudo openfortivpn ip:port --username<span style=color:#f92672>=</span>ricky --pppd-use-peerdns<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>
</span></span></code></pre></div></div></div></div></div><div class=note-card><div class=item><h5 class=note-title><span>openssl</span></h5><div class=card><div class=card-body><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># 自簽名證書，要把 ca.p7b 匯入 certmgr.msc 的受信任的根憑證授權單位，Chrome 才吃的到。</span>
</span></span><span style=display:flex><span>openssl crl2pkcs7 -nocrl -certfile ca.crt -out ca.p7b
</span></span></code></pre></div></div></div></div></div><div class=note-card><div class=item><h5 class=note-title><span>prlimit</span></h5><div class=card><div class=card-body><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># 更改 Max_open_files 遇到參數錯誤，原因為 CentOS6 與 CentOS7 指令不同</span>
</span></span><span style=display:flex><span><span style=color:#75715e># CentOS6</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> i in <span style=color:#66d9ef>$(</span>ps -ef | grep <span style=color:#e6db74>&#39;publish/server/game_server&#39;</span> | egrep -v <span style=color:#e6db74>&#39;grep|startall&#39;</span> | awk <span style=color:#e6db74>&#39;{print $2}&#39;</span><span style=color:#66d9ef>)</span>; <span style=color:#66d9ef>do</span> echo -n <span style=color:#e6db74>&#34;Max open files=1024000:1024000&#34;</span> &gt; /proc/$i/limits; <span style=color:#66d9ef>done</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># CentOS7</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> i in <span style=color:#66d9ef>$(</span>ps -ef | grep gateway | grep -v grep | awk <span style=color:#e6db74>&#39;{print $2}&#39;</span><span style=color:#66d9ef>)</span>; <span style=color:#66d9ef>do</span> prlimit --pid $i --nofile<span style=color:#f92672>=</span>1024000:1024000 ; <span style=color:#66d9ef>done</span>
</span></span></code></pre></div></div></div></div></div><div class=note-card><div class=item><h5 class=note-title><span>siege</span></h5><div class=card><div class=card-body><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>siege --time<span style=color:#f92672>=</span>3s --concurrent<span style=color:#f92672>=</span><span style=color:#ae81ff>30000</span> https://a8-h5.hddv1.com/index.html
</span></span></code></pre></div></div></div></div></div><div class=note-card><div class=item><h5 class=note-title><span>tr</span></h5><div class=card><div class=card-body><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># cat krypton2</span>
</span></span><span style=display:flex><span>YRIRY GJB CNFFJBEQ EBGGRA
</span></span><span style=display:flex><span><span style=color:#75715e># cat krypton2 | tr a-zA-Z n-za-mN-ZA-M</span>
</span></span><span style=display:flex><span>LEVEL TWO PASSWORD ROTTEN
</span></span></code></pre></div></div></div></div></div><div class=note-card><div class=item><h5 class=note-title><span>vegeta</span></h5><div class=card><div class=card-body><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e>#!/usr/bin/env bash
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>attack<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    echo <span style=color:#e6db74>&#34;GET </span><span style=color:#e6db74>${</span>1<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span> |
</span></span><span style=display:flex><span>        vegeta attack -duration<span style=color:#f92672>=</span>100s -header<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;User-Agent: baidu&#34;</span> -header<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;X-Forwarded-For: 47.0.0.1&#34;</span> -rate<span style=color:#f92672>=</span><span style=color:#ae81ff>500</span> -timeout<span style=color:#f92672>=</span>1s |
</span></span><span style=display:flex><span>        vegeta encode |
</span></span><span style=display:flex><span>        jaggr @count<span style=color:#f92672>=</span>rps <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>            hist<span style=color:#ae81ff>\[</span>100,200,300,400,500<span style=color:#ae81ff>\]</span>:code <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>            p25,p50,p95:latency <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>            sum:bytes_in <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>            sum:bytes_out |
</span></span><span style=display:flex><span>        jplot rps+code.hist.100+code.hist.200+code.hist.300+code.hist.400+code.hist.500 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>            latency.p95+latency.p50+latency.p25 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>            bytes_in.sum+bytes_out.sum
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> <span style=color:#f92672>[[</span> -n <span style=color:#e6db74>${</span>1<span style=color:#e6db74>}</span> <span style=color:#f92672>]]</span>; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>    attack <span style=color:#e6db74>${</span>1<span style=color:#e6db74>}</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>## -header=&#34;Connection: Upgrade&#34; -header=&#34;Upgrade: websocket&#34;</span>
</span></span></code></pre></div></div></div></div></div><div class=note-card><div class=item><h5 class=note-title><span>wrk</span></h5><div class=card><div class=card-body><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>wrk -t10 -c1000 -d30s -H <span style=color:#e6db74>&#34;User-Agent: baidu&#34;</span> <span style=color:#e6db74>&#34;https://default.hddv1.com/error&#34;</span>
</span></span></code></pre></div></div></div></div></div><div class=note-card><div class=item><h5 class=note-title><span>Vagrant with hyper-v provider</span></h5><div class=card><div class=card-body><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span>Enable-WindowsOptionalFeature -Online -FeatureName Microsoft-Hyper-V -All
</span></span></code></pre></div></div></div></div></div><div class=note-card><div class=item><h5 class=note-title><span>Common</span></h5><div class=card><div class=card-body><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># Find out processes swap usage command</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> file in /proc/*/status ; <span style=color:#66d9ef>do</span> awk <span style=color:#e6db74>&#39;/VmSwap|Name/{printf $2 &#34; &#34; $3}END{ print &#34;&#34;}&#39;</span> $file; <span style=color:#66d9ef>done</span> | sort -k <span style=color:#ae81ff>2</span> -n -r | less
</span></span></code></pre></div></div></div></div></div><div class=note-card><div class=item><h5 class=note-title><span>Gitbook</span></h5><div class=card><div class=card-body><p>Hide gitbook sidebar default.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>raw_path<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>pwd<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>npm install -g gitbook-cli
</span></span><span style=display:flex><span>gitbook install
</span></span><span style=display:flex><span>cd ~/.gitbook/versions/3.2.3/node_modules/gitbook-plugin-theme-default
</span></span><span style=display:flex><span>sed -i <span style=color:#e6db74>&#34;25i\ \ \ \ gitbook.storage.set(&#39;sidebar&#39;, false);&#34;</span> src/js/theme/sidebar.js
</span></span><span style=display:flex><span>npm install -g browserify uglify-js less less-plugin-clean-css
</span></span><span style=display:flex><span>npm install
</span></span><span style=display:flex><span>src/build.sh
</span></span></code></pre></div></div></div></div></div><div class=note-card><div class=item><h5 class=note-title><span>Install</span></h5><div class=card><div class=card-body><h6 id=--autocorrect>- autocorrect</h6><blockquote><p>A linter and formatter for help you improve copywriting, to correct spaces, words, punctuations between CJK (Chinese, Japanese, Korean). <a href=https://github.com/huacnlee/autocorrect target=_blank rel=noopener>Github</a></p></blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>wget https://github.com/huacnlee/autocorrect/releases/download/v1.7.4/autocorrect-darwin-amd64.tar.gz
</span></span></code></pre></div><h6 id=--bpf>- bpf</h6><blockquote><p>BCC - Tools for BPF-based Linux IO analysis, networking, monitoring, and more
Kernel should higher than 4.1
Install from source is better</p></blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># `/usr/share/bcc/`</span>
</span></span><span style=display:flex><span><span style=color:#75715e># https://github.com/iovisor/bcc</span>
</span></span><span style=display:flex><span><span style=color:#75715e># https://github.com/iovisor/bcc/blob/master/docs/reference_guide.md#1-kernel-source-directory</span>
</span></span><span style=display:flex><span><span style=color:#75715e># https://github.com/iovisor/bpftrace</span>
</span></span><span style=display:flex><span>yum install bcc-tools
</span></span></code></pre></div><h6 id=--flamegraph>- flamegraph</h6><blockquote><p>Stack trace visualizer</p></blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># https://github.com/brendangregg/FlameGraph</span>
</span></span><span style=display:flex><span>brew install flamegraph
</span></span></code></pre></div><h6 id=--git-split-diffs>- git-split-diffs</h6><blockquote><p>GitHub style split diffs in your terminal</p></blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>npm install -g git-split-diffs
</span></span></code></pre></div><h6 id=--glci>- glci</h6><blockquote><p>Test your Gitlab CI Pipelines changes locally using Docker. <a href=https://blog.chengweichen.com/2021/03/glci-gitlab-local-ci.html target=_blank rel=noopener>blog</a></p></blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>yarn global add glci
</span></span></code></pre></div><h6 id=--openresty>- openresty</h6><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>wget https://openresty.org/package/centos/openresty.repo -O /etc/yum.repos.d/openresty.repo
</span></span><span style=display:flex><span>yum install -y openresty openresty-resty
</span></span></code></pre></div><h6 id=--perf>- perf</h6><blockquote><p>Performance monitoring for the Linux kernel</p></blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># https://github.com/brendangregg/Misc/blob/master/perf_events/perf.md</span>
</span></span><span style=display:flex><span><span style=color:#75715e># http://www.brendangregg.com/perf.html</span>
</span></span><span style=display:flex><span>yum install perf
</span></span></code></pre></div><h6 id=--pptx2md>- pptx2md</h6><blockquote><p>A pptx to markdown converter</p></blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pip3 install pptx2md
</span></span></code></pre></div><h6 id=--sockperf>- sockperf</h6><blockquote><p>Network Benchmarking Utility</p></blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># https://github.com/Mellanox/sockperf</span>
</span></span><span style=display:flex><span>yum install sockperf
</span></span></code></pre></div><h6 id=--upx>- upx</h6><blockquote><p>UPX - the Ultimate Packer for eXecutables</p></blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>brew install upx
</span></span></code></pre></div><h6 id=--wrk>- wrk</h6><blockquote><p>Modern HTTP benchmarking tool</p></blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>brew install wrk
</span></span></code></pre></div></div></div></div></div><div class=note-card><div class=item><h5 class=note-title><span>LVM</span></h5><div class=card><div class=card-body><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># 確認 resize 在哪個 disk</span>
</span></span><span style=display:flex><span>lsblk
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 確認 `/dev/sde` 是否為該新增 disk 路徑</span>
</span></span><span style=display:flex><span>pvresize /dev/sde
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># vgdisplay [vg 編號]</span>
</span></span><span style=display:flex><span><span style=color:#75715e># 查 free  PE / Size 的編號</span>
</span></span><span style=display:flex><span>vgdisplay vg3
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 要升級的 lvm 硬碟路徑</span>
</span></span><span style=display:flex><span>lvdisplay
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># lvresize -l +[free 的編號] 升級的 lvm 硬碟路徑</span>
</span></span><span style=display:flex><span>lvresize -l +38400 /dev/vg3/disklvm4
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># resize</span>
</span></span><span style=display:flex><span>xfs_growfs /dev/vg3/disklvm4
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 檢查擴充是否成功</span>
</span></span><span style=display:flex><span>df -h
</span></span></code></pre></div></div></div></div></div><div class=note-card><div class=item><h5 class=note-title><span>Migration zabbix</span></h5><div class=card><div class=card-body><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>mysqldump -uroot --opt zabbix &gt; zabbix.sql
</span></span><span style=display:flex><span>rsync -az zabbix.sql newserver:/root
</span></span><span style=display:flex><span>mysql -uroot zabbix &lt; zabbix.sql
</span></span></code></pre></div></div></div></div></div><div class=note-card><div class=item><h5 class=note-title><span>Re-create /dev/null</span></h5><div class=card><div class=card-body><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>rm -f /dev/null
</span></span><span style=display:flex><span>mknod /dev/null c <span style=color:#ae81ff>1</span> <span style=color:#ae81ff>3</span>
</span></span></code></pre></div></div></div></div></div><div class=note-card><div class=item><h5 class=note-title><span>Script</span></h5><div class=card><div class=card-body><script src=https://gist.github.com/m-radzikowski/53e0b39e9a59a1518990e76c2bff8038.js></script></div></div></div></div><div class=note-card><div class=item><h5 class=note-title><span>Script Optimization</span></h5><div class=card><div class=card-body><p><a href=https://omid.dev/2024/06/19/advanced-shell-scripting-techniques-automating-complex-tasks-with-bash/ target=_blank rel=noopener>Advanced Shell Scripting Techniques: Automating Complex Tasks with Bash</a></p><ol><li>Use Built-in Commands: Built-in commands execute faster because they don&rsquo;t require loading an external process.</li><li>Minimize Subshells: Subshells can be expensive in terms of performance.</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># Inefficient</span>
</span></span><span style=display:flex><span>output<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>cat file.txt<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Efficient</span>
</span></span><span style=display:flex><span>output<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>&lt;file.txt<span style=color:#66d9ef>)</span>
</span></span></code></pre></div><ol start=3><li>Use Arrays for Bulk Data: When handling a large amount of data, arrays can be more efficient and easier to manage than multiple variables.</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># Inefficient</span>
</span></span><span style=display:flex><span>item1<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;apple&#34;</span>
</span></span><span style=display:flex><span>item2<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;banana&#34;</span>
</span></span><span style=display:flex><span>item3<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;cherry&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Efficient</span>
</span></span><span style=display:flex><span>items<span style=color:#f92672>=(</span><span style=color:#e6db74>&#34;apple&#34;</span> <span style=color:#e6db74>&#34;banana&#34;</span> <span style=color:#e6db74>&#34;cherry&#34;</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> item in <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>items[@]<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>; <span style=color:#66d9ef>do</span>
</span></span><span style=display:flex><span>    echo <span style=color:#e6db74>&#34;</span>$item<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>done</span>
</span></span></code></pre></div><ol start=4><li>Enable Noclobber: To prevent accidental overwriting of files.</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>set -o noclobber
</span></span></code></pre></div><ol start=5><li>Use Functions: Functions allow you to encapsulate and reuse code, making scripts cleaner and reducing redundancy.</li><li>Efficient File Operations: When performing file operations, use efficient techniques to minimize resource usage.</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># Inefficient</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>while</span> read -r line; <span style=color:#66d9ef>do</span>
</span></span><span style=display:flex><span>    echo <span style=color:#e6db74>&#34;</span>$line<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>done</span> &lt; file.txt
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Efficient</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>while</span> IFS<span style=color:#f92672>=</span> read -r line; <span style=color:#66d9ef>do</span>
</span></span><span style=display:flex><span>    echo <span style=color:#e6db74>&#34;</span>$line<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>done</span> &lt; file.txt
</span></span></code></pre></div><ol start=7><li>Parallel Processing: Tools like <code>xargs</code> and GNU <code>parallel</code> can be incredibly useful.</li><li>Error Handling: Robust error handling is critical for creating reliable and maintainable scripts.</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># Exit on Error: Using set -e ensures that your script exits immediately if any command fails, preventing cascading errors.</span>
</span></span><span style=display:flex><span>set -e
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Custom Error Messages: Implement custom error messages to provide more context when something goes wrong.</span>
</span></span><span style=display:flex><span>command1 <span style=color:#f92672>||</span> <span style=color:#f92672>{</span> echo <span style=color:#e6db74>&#34;command1 failed&#34;</span>; exit 1; <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Trap Signals: Use the `trap` command to catch and handle signals and errors gracefully.</span>
</span></span><span style=display:flex><span>trap <span style=color:#e6db74>&#39;echo &#34;Error occurred&#34;; cleanup; exit 1&#39;</span> ERR
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> cleanup<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># Cleanup code</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Validate Inputs: Always validate user inputs and script arguments to prevent unexpected behavior.</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> <span style=color:#f92672>[[</span> -z <span style=color:#e6db74>&#34;</span>$1<span style=color:#e6db74>&#34;</span> <span style=color:#f92672>]]</span>; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>    echo <span style=color:#e6db74>&#34;Usage: </span>$0<span style=color:#e6db74> &lt;argument&gt;&#34;</span>
</span></span><span style=display:flex><span>    exit <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Logging: Implement logging to keep track of script execution and diagnose issues.</span>
</span></span><span style=display:flex><span>logfile<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;script.log&#34;</span>
</span></span><span style=display:flex><span>exec &gt; &gt;<span style=color:#f92672>(</span>tee -i $logfile<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>exec 2&gt;&amp;<span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;Script started&#34;</span>
</span></span></code></pre></div><ol start=9><li>Automating Complex System Administration Tasks:<ol><li>Automated Backups</li><li>System Monitoring</li><li>User Management</li><li>Automated Updates</li><li>Network Configuration</li></ol></li></ol></div></div></div></div><div class=note-card><div class=item><h5 class=note-title><span>Diagrams</span></h5><div class=card><div class=card-body><a href=https://diagrams.mingrammer.com/docs/getting-started/installation target=_blank rel=noopener>https://diagrams.mingrammer.com/docs/getting-started/installation</a></div></div></div></div><div class=note-card><div class=item><h5 class=note-title><span>Build with secret</span></h5><div class=card><div class=card-body><ul><li>Dockerfile</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-dockerfile data-lang=dockerfile><span style=display:flex><span><span style=color:#75715e># syntax = docker/dockerfile:1.6</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>FROM</span><span style=color:#e6db74> golang:1.21.1-alpine3.18</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>RUN</span> --mount<span style=color:#f92672>=</span>type<span style=color:#f92672>=</span>secret,id<span style=color:#f92672>=</span>mysecret,target<span style=color:#f92672>=</span>/root/.ssh/id_rsa git clone git@gitlab.com:ricky/repo.git<span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div><ul><li>Command</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>export DOCKER_BUILDKIT<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>docker build --secret id<span style=color:#f92672>=</span>mysecret,src<span style=color:#f92672>=</span>id_rsa -t image .
</span></span></code></pre></div></div></div></div></div><div class=note-card><div class=item><h5 class=note-title><span>Compose</span></h5><div class=card><div class=card-body><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># Force pull image</span>
</span></span><span style=display:flex><span>docker-compose up -d --pull always
</span></span></code></pre></div></div></div></div></div><div class=note-card><div class=item><h5 class=note-title><span>Create buildx instance</span></h5><div class=card><div class=card-body><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># create buildx instance</span>
</span></span><span style=display:flex><span>docker buildx create --name builder --bootstrap --driver docker-container
</span></span><span style=display:flex><span><span style=color:#75715e># install emulators</span>
</span></span><span style=display:flex><span>docker run --privileged --rm tonistiigi/binfmt --install all
</span></span></code></pre></div></div></div></div></div><div class=note-card><div class=item><h5 class=note-title><span>Create Network</span></h5><div class=card><div class=card-body><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docker network create -d bridge --subnet 172.100.0.0/24 --gateway 172.100.0.1 backend_dev
</span></span></code></pre></div></div></div></div></div><div class=note-card><div class=item><h5 class=note-title><span>Multiple build-arg</span></h5><div class=card><div class=card-body><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docker build . -f ./scripts/Dockerfile <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --build-arg Date<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>date<span style=color:#66d9ef>)</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --build-arg Tag<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>git rev-list -n <span style=color:#ae81ff>1</span> --tags<span style=color:#66d9ef>)</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --build-arg Commit<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>git describe --tags --abbrev<span style=color:#f92672>=</span>0<span style=color:#66d9ef>)</span>  <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  -t ops-cli
</span></span></code></pre></div></div></div></div></div><div class=note-card><div class=item><h5 class=note-title><span>Multiple platform</span></h5><div class=card><div class=card-body><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># create and use buildx instance</span>
</span></span><span style=display:flex><span>docker buildx create --use --name builder
</span></span><span style=display:flex><span><span style=color:#75715e># build multiple platform</span>
</span></span><span style=display:flex><span>docker buildx build --push --platform linux/arm64,linux/amd64 -t zeyanlin/ops-cli .
</span></span></code></pre></div></div></div></div></div><div class=note-card><div class=item><h5 class=note-title><span>Run container in different platform</span></h5><div class=card><div class=card-body><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>finch run -it --rm --platform<span style=color:#f92672>=</span>linux/arm64 zeyanlin/ops-cli /bin/sh
</span></span></code></pre></div></div></div></div></div><div class=note-card><div class=item><h5 class=note-title><span>docker-compose</span></h5><div class=card><div class=card-body><h5 id=cadvisor>cAdvisor</h5><ul><li><a href=/notes/docs/docker/docker-compose/cadvisor/docker-compose.yaml>docker-compose.yaml</a></li><li><a href=/notes/docs/docker/docker-compose/cadvisor/prometheus.yaml>prometheus.yaml</a></li></ul><h5 id=elasticsearch>Elasticsearch</h5><ul><li><a href=/notes/docs/docker/docker-compose/elasticsearch/docker-compose.yaml>docker-compose.yaml</a></li></ul><h5 id=local-dev>local dev</h5><ul><li><a href=/notes/docs/docker/docker-compose/local/docker-compose.yaml>docker-compose.yaml</a></li></ul><h5 id=nodejs>NodeJS</h5><ul><li><a href=/notes/docs/docker/docker-compose/nodejs/docker-compose.yaml>docker-compose.yaml</a></li></ul><h5 id=rstudio>rstudio</h5><ul><li><a href=/notes/docs/docker/dockerfile/rstudio/docker-compose.yaml>docker-compose.yaml</a></li></ul><h5 id=rsyncd>rsyncd</h5><ul><li><a href=/notes/docs/docker/docker-compose/rsyncd/docker-compose.yaml>docker-compose.yaml</a></li><li><a href=/notes/docs/docker/docker-compose/rsyncd/rsyncd.conf>rsyncd.conf</a></li><li><a href=/notes/docs/docker/docker-compose/rsyncd/rsyncd.secrets>rsyncd.secrets</a></li><li><code>rsync -auz --password-file=/tmp/pass dist user@hostip::myshare</code></li></ul></div></div></div></div><div class=note-card><div class=item><h5 class=note-title><span>Dockerfile</span></h5><div class=card><div class=card-body><h5 id=awscli>awscli</h5><ul><li><a href=/notes/docs/docker/dockerfile/awscli/Dockerfile>Dockerfile</a></li></ul><h5 id=buildx>buildx</h5><ul><li><a href=/notes/docs/docker/dockerfile/buildx/Dockerfile>Dockerfile</a></li><li><code>docker buildx build --push --platform linux/arm64,linux/amd64 -t zeyanlin/app .</code></li></ul><h5 id=dind>dind</h5><ul><li><a href=/notes/docs/docker/dockerfile/dind/Dockerfile>Dockerfile</a></li></ul><h5 id=golang>golang</h5><ul><li><a href=/notes/docs/docker/dockerfile/golang/Dockerfile>Dockerfile</a></li><li><code>docker build --secret id=mysecret,src=id_rsa -t app .</code></li></ul><h5 id=goproxy>goproxy</h5><ul><li><a href=/notes/docs/docker/dockerfile/goproxy/Dockerfile>Dockerfile</a></li><li><code>docker buildx build -f goproxy/Dockerfile --platform linux/amd64,linux/arm64 -t zeyanlin/goproxy:latest --push .</code></li></ul><h5 id=gitlab-ci>Gitlab-ci</h5><ul><li><a href=/notes/docs/docker/dockerfile/gitlab/Dockerfile>Dockerfile</a></li><li><a href=/notes/docs/docker/dockerfile/gitlab/telegram.bash>telegram.bash</a></li></ul><h5 id=nginx><a href=https://github.com/macbre/docker-nginx-http3 target=_blank rel=noopener>nginx</a></h5><ul><li><a href=/notes/docs/docker/dockerfile/nginx/Dockerfile>Dockerfile</a></li><li><a href=/notes/docs/docker/dockerfile/nginx/docker-compose.yml>docker-compose.yml</a></li><li><a href=/notes/docs/docker/dockerfile/nginx/nginx.conf>nginx.conf</a></li></ul><h5 id=rstudio>rstudio</h5><ul><li><a href=/notes/docs/docker/dockerfile/rstudio/Dockerfile>Dockerfile</a></li><li><a href=/notes/docs/docker/dockerfile/rstudio/pkg.txt>pkg.txt</a></li></ul><h5 id=supervisord>supervisord</h5><ul><li><a href=/notes/docs/docker/dockerfile/supervisord/Dockerfile>Dockerfile</a></li><li><a href=/notes/docs/docker/dockerfile/supervisord/supervisord.conf>supervisord.conf</a><ul><li>service with supervisord<ul><li><a href=/notes/docs/docker/dockerfile/supervisord/service_with_supervisord/Dockerfile>Dockerfile</a></li></ul></li></ul></li></ul></div></div></div></div><div class=note-card><div class=item><h5 class=note-title><span>File create time</span></h5><div class=card><div class=card-body><h4 id=1-find-inode>1. Find Inode</h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ stat dns.yaml
</span></span><span style=display:flex><span>  File: dns.yaml
</span></span><span style=display:flex><span>  Size: <span style=color:#ae81ff>1003</span>        Blocks: <span style=color:#ae81ff>8</span>          IO Block: <span style=color:#ae81ff>4096</span>   regular file
</span></span><span style=display:flex><span>Device: ca01h/51713d    Inode: <span style=color:#ae81ff>3595636</span>     Links: <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>Access: <span style=color:#f92672>(</span>0644/-rw-r--r--<span style=color:#f92672>)</span>  Uid: <span style=color:#f92672>(</span> 1000/  ubuntu<span style=color:#f92672>)</span>   Gid: <span style=color:#f92672>(</span> 1000/  ubuntu<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Access: 2022-05-03 12:59:59.996755279 +0800
</span></span><span style=display:flex><span>Modify: 2021-12-10 18:27:54.157585209 +0800
</span></span><span style=display:flex><span>Change: 2022-01-07 14:57:58.619727878 +0800
</span></span><span style=display:flex><span> Birth: -
</span></span></code></pre></div><p>or</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ ls -i dns.yaml
</span></span><span style=display:flex><span><span style=color:#ae81ff>3585173</span> dns.yaml
</span></span></code></pre></div><h4 id=2-find-filesystem>2. Find Filesystem</h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ df dns.yaml
</span></span><span style=display:flex><span>Filesystem     1K-blocks     Used Available Use% Mounted on
</span></span><span style=display:flex><span>/dev/root      <span style=color:#ae81ff>101583780</span> <span style=color:#ae81ff>25703988</span>  <span style=color:#ae81ff>75863408</span>  26% /
</span></span></code></pre></div><h4 id=3-get-create-time>3. Get Create Time</h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ sudo debugfs -R <span style=color:#e6db74>&#39;stat &lt;3595636&gt;&#39;</span> /dev/root
</span></span><span style=display:flex><span>Inode: <span style=color:#ae81ff>3595636</span>   Type: regular    Mode:  <span style=color:#ae81ff>0644</span>   Flags: 0x80000
</span></span><span style=display:flex><span>Generation: <span style=color:#ae81ff>449657737</span>    Version: 0x00000000:00000001
</span></span><span style=display:flex><span>User:  <span style=color:#ae81ff>1000</span>   Group:  <span style=color:#ae81ff>1000</span>   Project:     <span style=color:#ae81ff>0</span>   Size: <span style=color:#ae81ff>1003</span>
</span></span><span style=display:flex><span>File ACL: <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>Links: <span style=color:#ae81ff>1</span>   Blockcount: <span style=color:#ae81ff>8</span>
</span></span><span style=display:flex><span>Fragment:  Address: <span style=color:#ae81ff>0</span>    Number: <span style=color:#ae81ff>0</span>    Size: <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span> ctime: 0x61d7e476:93c13018 -- Fri Jan  <span style=color:#ae81ff>7</span> 14:57:58 <span style=color:#ae81ff>2022</span>
</span></span><span style=display:flex><span> atime: 0x6270b6cf:eda51d3c -- Tue May  <span style=color:#ae81ff>3</span> 12:59:59 <span style=color:#ae81ff>2022</span>
</span></span><span style=display:flex><span> mtime: 0x61b32baa:25923ce4 -- Fri Dec <span style=color:#ae81ff>10</span> 18:27:54 <span style=color:#ae81ff>2021</span>
</span></span><span style=display:flex><span>crtime: 0x61b32baa:25923ce4 -- Fri Dec <span style=color:#ae81ff>10</span> 18:27:54 <span style=color:#ae81ff>2021</span>
</span></span><span style=display:flex><span>Size of extra inode fields: <span style=color:#ae81ff>32</span>
</span></span><span style=display:flex><span>Inode checksum: 0x5b176bb2
</span></span><span style=display:flex><span>EXTENTS:
</span></span><span style=display:flex><span><span style=color:#f92672>(</span>0<span style=color:#f92672>)</span>:2665902
</span></span></code></pre></div></div></div></div></div><div class=note-card><div class=item><h5 class=note-title><span>Display Ubuntu's Message of the Day</span></h5><div class=card><div class=card-body><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo chmod +x /etc/update-motd.d/*
</span></span></code></pre></div></div></div></div></div><div class=note-card><div class=item><h5 class=note-title><span>List domains</span></h5><div class=card><div class=card-body><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sed <span style=color:#e6db74>&#39;s/ //g&#39;</span> domains-info.md | awk -F <span style=color:#e6db74>&#39;|&#39;</span> <span style=color:#e6db74>&#39;{if($3 ~ /.*\.com/)print $3}&#39;</span> | sort | uniq
</span></span></code></pre></div></div></div></div></div></div><div class=paginator><ul class="pagination pagination-default"><li class="page-item disabled"><a aria-disabled=true aria-label=First class=page-link role=button tabindex=-1><span aria-hidden=true>&#171;&#171;</span></a></li><li class="page-item disabled"><a aria-disabled=true aria-label=Previous class=page-link role=button tabindex=-1><span aria-hidden=true>&#171;</span></a></li><li class="page-item active"><a aria-current=page aria-label="Page 1" class=page-link role=button>1</a></li><li class=page-item><a href=/notes/page/2/ aria-label="Page 2" class=page-link role=button>2</a></li><li class=page-item><a href=/notes/page/3/ aria-label="Page 3" class=page-link role=button>3</a></li><li class=page-item><a href=/notes/page/4/ aria-label="Page 4" class=page-link role=button>4</a></li><li class=page-item><a href=/notes/page/5/ aria-label="Page 5" class=page-link role=button>5</a></li><li class=page-item><a href=/notes/page/2/ aria-label=Next class=page-link role=button><span aria-hidden=true>&#187;</span></a></li><li class=page-item><a href=/notes/page/6/ aria-label=Last class=page-link role=button><span aria-hidden=true>&#187;&#187;</span></a></li></ul></div></div></section></div><footer id=footer class="container-fluid text-center align-content-center footer pb-2"><div class="container pt-5"><div class="row text-start"><div class="col-md-4 col-sm-12"><h5>Navigation</h5><ul><li class=nav-item><a class=smooth-scroll href=https://linzeyan.github.io/#about>About</a></li><li class=nav-item><a class=smooth-scroll href=https://linzeyan.github.io/#skills>Skills</a></li><li class=nav-item><a class=smooth-scroll href=https://linzeyan.github.io/#experiences>Experiences</a></li><li class=nav-item><a class=smooth-scroll href=https://linzeyan.github.io/#education>Education</a></li><li class=nav-item><a class=smooth-scroll href=https://linzeyan.github.io/#projects>Projects</a></li></ul></div><div class="col-md-4 col-sm-12"><h5>Contact me:</h5><ul><li><a href=mailto:zeyanlin@outlook.com target=_blank rel=noopener><span><i class="fas fa-envelope"></i></span> <span>zeyanlin@outlook.com</span></a></li><li><a href=https://github.com/linzeyan target=_blank rel=noopener><span><i class="fab fa-github"></i></span> <span>linzeyan</span></a></li><li><a href=https://line.me/ti/p/m7ME9ChZXV target=_blank rel=noopener><span><i class="fab fa-fab fa-line"></i></span> <span>Ricky</span></a></li><li><a href=https://www.strava.com/athletes/rickylin target=_blank rel=noopener><span><i class="fab fa-fab fa-strava"></i></span> <span>Ricky</span></a></li><li><a href=https://t.me/ricky_lin target=_blank rel=noopener><span><i class="fab fa-fab fa-telegram"></i></span> <span>Ricky</span></a></li></ul></div></div></div></footer><script src=/application.eed5c22001d7c9cc6de7d8db62219c198319957fa017da141928bee1c40883b4.js integrity="sha256-7tXCIAHXycxt59jbYiGcGYMZlX+gF9oUGSi+4cQIg7Q=" defer></script></body></html>